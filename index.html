<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HOPEYA TRADING - Modern Dark</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');
        
        :root {
            --primary-purple: #8B5CF6;
            --dark-purple: #6D28D9;
            --light-purple: #A78BFA;
            --dark-bg: #0F0F23;
            --card-bg: #1A1A2E;
            --accent-bg: #16213E;
        }
        
        body { 
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #0F0F23 0%, #1A1A2E 50%, #16213E 100%);
            min-height: 100vh;
            color: #FFFFFF;
        }
        
        .modern-card {
            background: rgba(26, 26, 46, 0.8);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(139, 92, 246, 0.2);
            border-radius: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .modern-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 20px 40px rgba(139, 92, 246, 0.2);
            border-color: rgba(139, 92, 246, 0.4);
        }
        
        .pill-button {
            background: linear-gradient(135deg, var(--primary-purple), var(--dark-purple));
            border: none;
            border-radius: 50px;
            color: white;
            font-weight: 600;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 4px 20px rgba(139, 92, 246, 0.3);
            position: relative;
            overflow: hidden;
        }
        
        .pill-button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }
        
        .pill-button:hover::before {
            left: 100%;
        }
        
        .pill-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 30px rgba(139, 92, 246, 0.5);
        }
        
        .pill-button:active {
            transform: translateY(0);
        }
        
        .modern-input {
            background: rgba(22, 33, 62, 0.6);
            border: 2px solid rgba(139, 92, 246, 0.3);
            color: #FFFFFF;
            border-radius: 16px;
            transition: all 0.3s ease;
            font-weight: 400;
        }
        
        .modern-input:focus {
            outline: none;
            border-color: var(--primary-purple);
            box-shadow: 0 0 0 4px rgba(139, 92, 246, 0.1);
            background: rgba(22, 33, 62, 0.8);
        }
        
        .modern-input::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }
        
        .tab-container {
            background: rgba(26, 26, 46, 0.9);
            backdrop-filter: blur(20px);
            border-radius: 25px;
            padding: 8px;
            border: 1px solid rgba(139, 92, 246, 0.2);
        }
        
        .tab-active {
            background: linear-gradient(135deg, var(--primary-purple), var(--dark-purple));
            color: white;
            border-radius: 20px;
            box-shadow: 0 4px 15px rgba(139, 92, 246, 0.4);
            transform: scale(1.02);
        }
        
        .tab-inactive {
            background: transparent;
            color: rgba(255, 255, 255, 0.7);
            border-radius: 20px;
            transition: all 0.3s ease;
        }
        
        .tab-inactive:hover {
            background: rgba(139, 92, 246, 0.1);
            color: white;
            transform: translateY(-1px);
        }
        
        .header-glass {
            background: rgba(15, 15, 35, 0.9);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(139, 92, 246, 0.2);
        }
        
        .success-glow {
            background: linear-gradient(135deg, #10B981, #059669);
            box-shadow: 0 8px 25px rgba(16, 185, 129, 0.3);
        }
        
        .danger-glow {
            background: linear-gradient(135deg, #EF4444, #DC2626);
            box-shadow: 0 8px 25px rgba(239, 68, 68, 0.3);
        }
        
        .warning-glow {
            background: linear-gradient(135deg, #F59E0B, #D97706);
            box-shadow: 0 8px 25px rgba(245, 158, 11, 0.3);
        }
        
        .minimal-icon {
            width: 20px;
            height: 20px;
            stroke-width: 2;
            transition: all 0.3s ease;
        }
        
        .glow-text {
            color: var(--primary-purple);
            font-weight: 700;
            text-shadow: 0 0 20px rgba(139, 92, 246, 0.5);
        }
        
        .soft-glow {
            box-shadow: 0 0 20px rgba(139, 92, 246, 0.3);
        }
        
        .record-card {
            background: rgba(26, 26, 46, 0.7);
            border: 1px solid rgba(139, 92, 246, 0.2);
            border-radius: 16px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .record-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 30px rgba(0, 0, 0, 0.4);
            border-color: rgba(139, 92, 246, 0.4);
        }
        
        .win-accent {
            border-left: 4px solid #10B981;
            background: linear-gradient(90deg, rgba(16, 185, 129, 0.1), transparent);
        }
        
        .loss-accent {
            border-left: 4px solid #EF4444;
            background: linear-gradient(90deg, rgba(239, 68, 68, 0.1), transparent);
        }
        
        .pending-accent {
            border-left: 4px solid #F59E0B;
            background: linear-gradient(90deg, rgba(245, 158, 11, 0.1), transparent);
        }
        
        .stat-card {
            background: rgba(22, 33, 62, 0.8);
            border: 1px solid rgba(139, 92, 246, 0.3);
            border-radius: 20px;
            backdrop-filter: blur(10px);
        }
        
        .checklist-item {
            background: rgba(22, 33, 62, 0.6);
            border: 2px solid rgba(139, 92, 246, 0.2);
            border-radius: 16px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .checklist-item.completed {
            background: linear-gradient(135deg, #10B981, #059669);
            border-color: #10B981;
            box-shadow: 0 8px 25px rgba(16, 185, 129, 0.3);
        }
        
        .checklist-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(139, 92, 246, 0.2);
            border-color: rgba(139, 92, 246, 0.4);
        }
        
        .modern-checkbox {
            width: 24px;
            height: 24px;
            background: rgba(22, 33, 62, 0.8);
            border: 2px solid rgba(139, 92, 246, 0.4);
            border-radius: 8px;
            position: relative;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .modern-checkbox.checked {
            background: linear-gradient(135deg, var(--primary-purple), var(--dark-purple));
            border-color: var(--primary-purple);
            box-shadow: 0 0 15px rgba(139, 92, 246, 0.5);
        }
        
        .modern-checkbox.checked::after {
            content: '✓';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-size: 14px;
            font-weight: bold;
        }
        
        .progress-bar-modern {
            background: linear-gradient(90deg, var(--primary-purple), var(--light-purple));
            height: 100%;
            border-radius: 12px;
            transition: width 0.8s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 0 15px rgba(139, 92, 246, 0.4);
        }
        
        .modal-backdrop {
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
        }
        
        .language-toggle {
            background: rgba(26, 26, 46, 0.8);
            border: 1px solid rgba(139, 92, 246, 0.3);
            border-radius: 50px;
            color: white;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }
        
        .language-toggle:hover {
            background: rgba(139, 92, 246, 0.2);
            box-shadow: 0 0 15px rgba(139, 92, 246, 0.3);
        }
        
        .blink-glow {
            animation: blink-glow 2s infinite;
        }
        
        @keyframes blink-glow {
            0%, 50% { 
                opacity: 1; 
                text-shadow: 0 0 20px rgba(139, 92, 246, 0.8);
            }
            51%, 100% { 
                opacity: 0.6; 
                text-shadow: 0 0 10px rgba(139, 92, 246, 0.4);
            }
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .slide-up {
            animation: slideUp 0.3s ease-out;
        }
        
        @keyframes slideUp {
            from { transform: translateY(10px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        /* Scrollbar styling */
        ::-webkit-scrollbar {
            width: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: rgba(26, 26, 46, 0.5);
            border-radius: 10px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, var(--primary-purple), var(--dark-purple));
            border-radius: 10px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(135deg, var(--light-purple), var(--primary-purple));
        }
        
        /* Hide scrollbar for navigation tabs */
        .scrollbar-hide {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        
        .scrollbar-hide::-webkit-scrollbar {
            display: none;
        }
        
        .text-gradient {
            background: linear-gradient(135deg, var(--primary-purple), var(--light-purple));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .line-clamp-2 {
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        
        .badge-modern {
            background: rgba(139, 92, 246, 0.2);
            border: 1px solid rgba(139, 92, 246, 0.4);
            border-radius: 20px;
            font-weight: 600;
            font-size: 11px;
            backdrop-filter: blur(10px);
        }
        
        .badge-success {
            background: rgba(16, 185, 129, 0.2);
            border: 1px solid rgba(16, 185, 129, 0.4);
            color: #10B981;
        }
        
        .badge-danger {
            background: rgba(239, 68, 68, 0.2);
            border: 1px solid rgba(239, 68, 68, 0.4);
            color: #EF4444;
        }
        
        .badge-warning {
            background: rgba(245, 158, 11, 0.2);
            border: 1px solid rgba(245, 158, 11, 0.4);
            color: #F59E0B;
        }
        
        .glass-effect {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
    </style>
</head>
<body class="min-h-screen">
    <!-- Header -->
    <div class="header-glass p-6 text-center relative">
        <!-- Language Switcher -->
        <button id="languageToggle" class="language-toggle absolute top-6 right-6 px-4 py-2 text-sm font-medium">
            🌐 <span id="currentLang">EN</span>
        </button>
        
        <div class="fade-in">
            <h1 class="text-2xl font-800 text-white mb-2" data-lang-key="app-title">
                <span class="text-gradient">HOPEYA</span> TRADING
            </h1>
            <p class="text-sm font-300 text-purple-300" data-lang-key="app-subtitle">Modern Trading System</p>
            <div class="mt-3 text-sm font-500 glow-text" data-lang-key="app-features">
                ✅ Smart Checklist & 🧮 Advanced Calculator
            </div>
        </div>
    </div>

    <!-- Navigation -->
    <div class="max-w-md mx-auto p-6">
        <div class="tab-container fade-in">
            <div class="flex overflow-x-auto scrollbar-hide space-x-1 pb-1" style="scroll-behavior: smooth; -webkit-overflow-scrolling: touch;">
                <button id="checklistTab" class="tab-active px-4 py-3 text-xs font-600 flex-shrink-0 min-w-[80px]">
                    <div class="text-center">
                        <div class="text-base mb-1">✅</div>
                        <div data-lang-key="tab-checklist" class="whitespace-nowrap">CHECKLIST</div>
                    </div>
                </button>
                <button id="calculatorTab" class="tab-inactive px-4 py-3 text-xs font-600 flex-shrink-0 min-w-[80px]">
                    <div class="text-center">
                        <div class="text-base mb-1">🧮</div>
                        <div data-lang-key="tab-calc" class="whitespace-nowrap">CALC</div>
                    </div>
                </button>
                <button id="recordsTab" class="tab-inactive px-4 py-3 text-xs font-600 flex-shrink-0 min-w-[80px]">
                    <div class="text-center">
                        <div class="text-base mb-1">📝</div>
                        <div data-lang-key="tab-records" class="whitespace-nowrap">RECORDS</div>
                    </div>
                </button>
                <button id="statsTab" class="tab-inactive px-4 py-3 text-xs font-600 flex-shrink-0 min-w-[80px]">
                    <div class="text-center">
                        <div class="text-base mb-1">📊</div>
                        <div data-lang-key="tab-stats" class="whitespace-nowrap">STATS</div>
                    </div>
                </button>
                <button id="techniquesTab" class="tab-inactive px-4 py-3 text-xs font-600 flex-shrink-0 min-w-[80px]">
                    <div class="text-center">
                        <div class="text-base mb-1">📚</div>
                        <div data-lang-key="tab-techniques" class="whitespace-nowrap">TECH</div>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- Daily Limit Warning -->
    <div id="dailyLimitWarning" class="max-w-md mx-auto px-6 mb-6 hidden">
        <div class="danger-glow modern-card p-6 text-center slide-up">
            <h3 class="text-lg font-700 text-white mb-3" data-lang-key="daily-limit-title">🚫 DAILY LIMIT REACHED!</h3>
            <p class="text-sm font-400 text-white mb-2" data-lang-key="daily-limit-trades">5 TRADES COMPLETED TODAY</p>
            <p class="text-sm font-300 text-white mb-4" data-lang-key="daily-limit-reset">RESET AT 06:00 AM</p>
            <div class="badge-modern badge-warning px-4 py-2 inline-block" data-lang-key="daily-limit-discipline">
                DISCIPLINE = FREEDOM
            </div>
        </div>
    </div>

    <!-- Main Container -->
    <div class="max-w-md mx-auto px-6 pb-8">
        <!-- Checklist Page -->
        <div id="checklistPage">
            <!-- Preset Management -->
            <div class="modern-card p-6 mb-6 fade-in">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-lg font-700 glow-text" data-lang-key="select-preset">📋 SELECT PRESET</h2>
                    <button id="createPresetBtn" class="pill-button px-4 py-2 text-sm font-600" data-lang-key="new-preset">
                        ➕ NEW
                    </button>
                </div>
                
                <div class="mb-4">
                    <select id="presetSelector" class="modern-input w-full p-4 text-sm font-500">
                        <option value="" data-lang-key="choose-preset">-- CHOOSE PRESET --</option>
                    </select>
                </div>
                
                <div id="presetActions" class="flex gap-3 hidden">
                    <button id="editSelectedPreset" class="pill-button flex-1 py-3 text-sm font-600" data-lang-key="edit-preset">
                        ✏️ EDIT
                    </button>
                    <button id="deleteSelectedPreset" class="danger-glow flex-1 py-3 text-sm font-600 rounded-full" data-lang-key="delete-preset">
                        🗑️ DELETE
                    </button>
                </div>
            </div>

            <!-- Active Checklist -->
            <div id="activeChecklistSection" class="modern-card p-6 mb-6 hidden slide-up">
                <div class="flex justify-between items-center mb-6">
                    <h2 id="activePresetName" class="text-lg font-700 glow-text"></h2>
                    <div class="flex gap-2">
                        <button id="editActivePreset" class="language-toggle px-3 py-2 text-sm font-500">
                            ✏️
                        </button>
                        <button id="resetChecklist" class="warning-glow px-3 py-2 text-sm font-500 rounded-full">
                            🔄
                        </button>
                    </div>
                </div>
                
                <div id="checklistItems" class="space-y-4 mb-6"></div>
                
                <div class="stat-card p-4">
                    <div class="flex justify-between items-center mb-3">
                        <span class="text-sm font-600 text-white">PROGRESS:</span>
                        <span id="progressText" class="text-sm font-700 glow-text">0/0</span>
                    </div>
                    <div class="glass-effect p-2 rounded-xl">
                        <div id="progressBar" class="progress-bar-modern h-3 rounded-lg" style="width: 0%"></div>
                    </div>
                </div>
            </div>

            <!-- Next Page Button -->
            <div class="text-center">
                <button id="nextToCalculator" class="pill-button w-full py-4 text-lg font-700" data-lang-key="next-calculator">
                    🧮 NEXT: CALCULATOR →
                </button>
            </div>
        </div>

        <!-- Calculator Page -->
        <div id="calculatorPage" class="hidden">
            <!-- Trading Type Selection -->
            <div class="modern-card p-6 mb-6 fade-in">
                <h2 class="text-lg font-700 glow-text mb-6 text-center" data-lang-key="trading-type">SELECT TRADING TYPE:</h2>
                <div class="grid grid-cols-2 gap-4">
                    <button id="forexBtn" class="pill-button py-6 text-center">
                        <div class="text-2xl mb-2">💱</div>
                        <div class="text-sm font-600" data-lang-key="forex">FOREX</div>
                    </button>
                    <button id="cryptoBtn" class="tab-inactive py-6 text-center border border-purple-500/30 rounded-3xl">
                        <div class="text-2xl mb-2">₿</div>
                        <div class="text-sm font-600" data-lang-key="crypto">CRYPTO</div>
                    </button>
                </div>
            </div>

            <!-- Forex Calculator -->
            <div id="forexCalculator" class="modern-card p-6 mb-6 slide-up">
                <h3 class="text-lg font-700 glow-text mb-6" data-lang-key="forex-calculator">🔢 FOREX CALCULATOR</h3>
                <div class="space-y-4">
                    <div>
                        <label class="text-sm font-600 text-white block mb-2">CURRENCY PAIR:</label>
                        <select id="currencyPair" class="modern-input w-full p-4 text-sm font-500">
                            <option value="EURUSD">EUR/USD</option>
                            <option value="GBPUSD">GBP/USD</option>
                            <option value="AUDUSD">AUD/USD</option>
                            <option value="NZDUSD">NZD/USD</option>
                            <option value="USDCHF">USD/CHF</option>
                            <option value="USDCAD">USD/CAD</option>
                            <option value="USDJPY">USD/JPY</option>
                            <option value="EURJPY">EUR/JPY</option>
                            <option value="GBPJPY">GBP/JPY</option>
                            <option value="AUDJPY">AUD/JPY</option>
                            <option value="NZDJPY">NZD/JPY</option>
                            <option value="CADJPY">CAD/JPY</option>
                            <option value="XAUUSD">XAU/USD (GOLD)</option>
                            <option value="XAGUSD">XAG/USD (SILVER)</option>
                            <option value="USOIL">US OIL</option>
                            <option value="UKOIL">UK OIL</option>
                            <option value="US30">US30</option>
                            <option value="NAS100">NAS100</option>
                            <option value="SPX500">SPX500</option>
                        </select>
                    </div>

                    <div>
                        <label class="text-sm font-600 text-white block mb-2">ACCOUNT TYPE:</label>
                        <select id="accountCurrency" class="modern-input w-full p-4 text-sm font-500">
                            <option value="USD">USD</option>
                            <option value="CENT">CENT</option>
                        </select>
                    </div>

                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="text-sm font-600 text-white block mb-2">ENTRY PRICE:</label>
                            <input type="number" id="entryPrice" step="0.00001" class="modern-input w-full p-4 text-sm font-500" placeholder="1.08500">
                        </div>

                        <div>
                            <label class="text-sm font-600 text-white block mb-2">STOP LOSS:</label>
                            <input type="number" id="stopLoss" step="0.00001" class="modern-input w-full p-4 text-sm font-500" placeholder="1.08000">
                        </div>
                    </div>

                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="text-sm font-600 text-white block mb-2">BALANCE:</label>
                            <input type="number" id="accountBalance" step="0.01" class="modern-input w-full p-4 text-sm font-500" placeholder="1000">
                        </div>

                        <div>
                            <label class="text-sm font-600 text-white block mb-2">RISK (%):</label>
                            <input type="number" id="riskPercent" step="0.1" max="100" class="modern-input w-full p-4 text-sm font-500" placeholder="2">
                        </div>
                    </div>
                </div>
            </div>

            <!-- Crypto Calculator -->
            <div id="cryptoCalculator" class="modern-card p-6 mb-6 hidden slide-up">
                <h3 class="text-lg font-700 glow-text mb-6" data-lang-key="crypto-calculator">₿ CRYPTO CALCULATOR</h3>
                
                <div class="space-y-4">
                    <div>
                        <label class="text-sm font-600 text-white block mb-2">CRYPTO PAIR:</label>
                        <select id="cryptoCoin" class="modern-input w-full p-4 text-sm font-500">
                            <option value="BTCUSDT">BTC/USDT</option>
                            <option value="ETHUSDT">ETH/USDT</option>
                            <option value="BNBUSDT">BNB/USDT</option>
                            <option value="ADAUSDT">ADA/USDT</option>
                            <option value="SOLUSDT">SOL/USDT</option>
                            <option value="XRPUSDT">XRP/USDT</option>
                            <option value="DOTUSDT">DOT/USDT</option>
                            <option value="AVAXUSDT">AVAX/USDT</option>
                            <option value="MATICUSDT">MATIC/USDT</option>
                            <option value="LINKUSDT">LINK/USDT</option>
                        </select>
                    </div>

                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="text-sm font-600 text-white block mb-2">ENTRY PRICE:</label>
                            <input type="number" id="cryptoEntryPrice" step="0.00001" class="modern-input w-full p-4 text-sm font-500" placeholder="45000">
                        </div>

                        <div>
                            <label class="text-sm font-600 text-white block mb-2">STOP LOSS:</label>
                            <input type="number" id="cryptoStopLoss" step="0.00001" class="modern-input w-full p-4 text-sm font-500" placeholder="44000">
                        </div>
                    </div>

                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="text-sm font-600 text-white block mb-2">BALANCE (USDT):</label>
                            <input type="number" id="cryptoAccountBalance" step="0.01" class="modern-input w-full p-4 text-sm font-500" placeholder="1000">
                        </div>

                        <div>
                            <label class="text-sm font-600 text-white block mb-2">LEVERAGE (X):</label>
                            <input type="number" id="leverage" step="1" min="1" max="125" class="modern-input w-full p-4 text-sm font-500" placeholder="10">
                        </div>
                    </div>

                    <div>
                        <label class="text-sm font-600 text-white block mb-2">RISK (%):</label>
                        <input type="number" id="cryptoRiskPercent" step="0.1" max="100" class="modern-input w-full p-4 text-sm font-500" placeholder="2">
                    </div>
                </div>
            </div>

            <!-- Calculate Button -->
            <div class="text-center mb-6">
                <button id="calculateBtn" class="pill-button px-8 py-4 text-lg font-700" data-lang-key="calculate">
                    🧮 CALCULATE
                </button>
            </div>

            <!-- Results -->
            <div id="results" class="modern-card p-6 hidden slide-up">
                <h3 class="text-lg font-700 glow-text mb-6" data-lang-key="results-title">📊 RESULTS</h3>
                <div id="resultContent"></div>
                
                <!-- Save Confirmation -->
                <div id="saveConfirmation" class="warning-glow modern-card p-4 mt-6 hidden">
                    <p class="text-sm font-600 text-white mb-4" data-lang-key="save-data">💾 SAVE THIS DATA?</p>
                    <div class="flex gap-3">
                        <button id="confirmSave" class="success-glow flex-1 py-3 px-4 text-sm font-600 text-white rounded-full" data-lang-key="save-confirm">
                            ✅ SAVE
                        </button>
                        <button id="cancelSave" class="language-toggle flex-1 py-3 px-4 text-sm font-600 rounded-full" data-lang-key="save-skip">
                            ❌ SKIP
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Records Page -->
        <div id="recordsPage" class="hidden">
            <div class="modern-card p-6 mb-6 fade-in">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-lg font-700 glow-text" data-lang-key="trade-records">📝 TRADE RECORDS</h2>
                    <div class="flex gap-2">
                        <button id="sortNewest" class="sort-btn pill-button px-3 py-2 text-sm font-600" data-lang-key="sort-new">
                            ⬇️ NEW
                        </button>
                        <button id="sortOldest" class="sort-btn language-toggle px-3 py-2 text-sm font-600" data-lang-key="sort-old">
                            ⬆️ OLD
                        </button>
                    </div>
                </div>
                <div id="recordsList">
                    <p class="text-center py-8 text-purple-300 text-sm font-400" data-lang-key="no-data">NO TRADING DATA</p>
                </div>
            </div>
        </div>

        <!-- Techniques Page -->
        <div id="techniquesPage" class="hidden">
            <!-- Category Management -->
            <div class="modern-card p-6 mb-6 fade-in">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-lg font-700 glow-text" data-lang-key="techniques-title">📚 TRADING TECHNIQUES</h2>
                    <button id="addCategoryBtn" class="pill-button px-4 py-2 text-sm font-600" data-lang-key="add-category">
                        ➕ ADD CATEGORY
                    </button>
                </div>
                
                <div id="categoriesList" class="space-y-4">
                    <p class="text-center py-8 text-purple-300 text-sm font-400" data-lang-key="no-categories">NO CATEGORIES YET</p>
                </div>
            </div>
        </div>

        <!-- Statistics Page -->
        <div id="statsPage" class="hidden">
            <div class="modern-card p-6 mb-6 fade-in">
                <h2 class="text-lg font-700 glow-text mb-6 text-center" data-lang-key="trading-stats">📊 TRADING STATS</h2>
                <div id="statsContent">
                    <div class="grid grid-cols-2 gap-4 mb-6">
                        <div class="stat-card p-4 text-center">
                            <div class="text-2xl font-800 glow-text" id="totalTrades">0</div>
                            <div class="text-sm font-400 text-white" data-lang-key="total">TOTAL</div>
                        </div>
                        <div class="stat-card p-4 text-center">
                            <div class="text-2xl font-800 text-green-400" id="winRate">0%</div>
                            <div class="text-sm font-400 text-white" data-lang-key="win-rate">WIN RATE</div>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-4 mb-6">
                        <div class="stat-card p-4 text-center">
                            <div class="text-2xl font-800 text-green-400" id="winStreak">0</div>
                            <div class="text-sm font-400 text-white" data-lang-key="win-streak">WIN STREAK</div>
                        </div>
                        <div class="stat-card p-4 text-center">
                            <div class="text-2xl font-800 text-red-400" id="lossStreak">0</div>
                            <div class="text-sm font-400 text-white" data-lang-key="loss-streak">LOSS STREAK</div>
                        </div>
                    </div>
                    
                    <div class="stat-card p-4 text-center mb-6">
                        <div class="text-2xl font-800" id="netProfit">0</div>
                        <div class="text-sm font-400 text-white" data-lang-key="net-profit">NET PROFIT</div>
                    </div>
                    
                    <div class="stat-card p-4 text-center mb-6">
                        <div class="text-lg font-700 text-purple-400" id="avgRR">0:0</div>
                        <div class="text-sm font-400 text-white" data-lang-key="avg-rr">AVG R:R</div>
                    </div>
                    
                    <div class="modern-card p-6 mb-6">
                        <h3 class="text-sm font-600 glow-text mb-4" data-lang-key="performance-chart">📈 PERFORMANCE CHART</h3>
                        <div id="chartContainer" class="flex items-end justify-center space-x-6" style="height: 120px;">
                            <div class="text-sm text-purple-300 font-400" data-lang-key="insufficient-data">INSUFFICIENT DATA</div>
                        </div>
                    </div>
                    
                    <div class="modern-card p-6">
                        <h3 class="text-sm font-600 glow-text mb-4" data-lang-key="preset-stats">📋 PRESET STATS</h3>
                        <div id="presetStats">
                            <p class="text-center py-6 text-purple-300 text-sm font-400" data-lang-key="no-preset-data">NO PRESET DATA</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Create/Edit Preset Modal -->
        <div id="presetModal" class="modal-backdrop fixed top-0 left-0 w-full h-full flex items-center justify-center hidden z-50">
            <div class="modern-card p-6 soft-glow" style="max-width: 500px; width: 90%; max-height: 90vh; overflow-y: auto;">
                <div class="mb-6">
                    <h3 id="presetModalTitle" class="text-lg font-700 glow-text">📋 CREATE NEW PRESET</h3>
                </div>
                <div class="space-y-6">
                    <div>
                        <label class="text-sm font-600 text-white block mb-2">PRESET NAME:</label>
                        <input type="text" id="presetName" class="modern-input w-full p-4 text-sm font-500" placeholder="PRE-TRADE CHECKLIST">
                    </div>
                    
                    <div>
                        <label class="text-sm font-600 text-white block mb-3">CHECKLIST ITEMS:</label>
                        <div id="checklistItemsEditor" class="space-y-3 mb-4">
                            <div class="flex gap-3">
                                <input type="text" class="modern-input flex-1 p-4 text-sm font-500" placeholder="ITEM 1">
                                <button class="remove-item danger-glow text-white px-4 py-4 text-sm font-600 rounded-2xl">🗑️</button>
                            </div>
                        </div>
                        <button id="addItemBtn" class="pill-button w-full py-3 text-sm font-600">
                            ➕ ADD ITEM
                        </button>
                    </div>
                </div>
                <div class="flex gap-3 mt-6">
                    <button id="savePreset" class="pill-button flex-1 py-3 text-sm font-600">
                        💾 SAVE
                    </button>
                    <button id="cancelPreset" class="language-toggle flex-1 py-3 text-sm font-600 rounded-full">
                        ❌ CANCEL
                    </button>
                </div>
            </div>
        </div>

        <!-- Category Modal -->
        <div id="categoryModal" class="modal-backdrop fixed top-0 left-0 w-full h-full flex items-center justify-center hidden z-50">
            <div class="modern-card p-6 soft-glow" style="max-width: 500px; width: 90%;">
                <div class="mb-6">
                    <h3 id="categoryModalTitle" class="text-lg font-700 glow-text" data-lang-key="add-category-title">📚 ADD NEW CATEGORY</h3>
                </div>
                <div class="space-y-4">
                    <div>
                        <label class="text-sm font-600 text-white block mb-2" data-lang-key="category-name">CATEGORY NAME:</label>
                        <input type="text" id="categoryName" class="modern-input w-full p-4 text-sm font-500" data-lang-key="category-placeholder" placeholder="e.g., CANDLESTICK PATTERNS">
                    </div>
                    
                    <div>
                        <label class="text-sm font-600 text-white block mb-2" data-lang-key="category-icon">CATEGORY ICON:</label>
                        <div class="grid grid-cols-6 gap-3">
                            <button type="button" class="icon-option modern-input p-3 text-center text-lg hover:bg-purple-600/30" data-icon="🕯️">🕯️</button>
                            <button type="button" class="icon-option modern-input p-3 text-center text-lg hover:bg-purple-600/30" data-icon="📈">📈</button>
                            <button type="button" class="icon-option modern-input p-3 text-center text-lg hover:bg-purple-600/30" data-icon="📉">📉</button>
                            <button type="button" class="icon-option modern-input p-3 text-center text-lg hover:bg-purple-600/30" data-icon="🎯">🎯</button>
                            <button type="button" class="icon-option modern-input p-3 text-center text-lg hover:bg-purple-600/30" data-icon="⚡">⚡</button>
                            <button type="button" class="icon-option modern-input p-3 text-center text-lg hover:bg-purple-600/30" data-icon="🔥">🔥</button>
                            <button type="button" class="icon-option modern-input p-3 text-center text-lg hover:bg-purple-600/30" data-icon="💎">💎</button>
                            <button type="button" class="icon-option modern-input p-3 text-center text-lg hover:bg-purple-600/30" data-icon="🚀">🚀</button>
                            <button type="button" class="icon-option modern-input p-3 text-center text-lg hover:bg-purple-600/30" data-icon="⭐">⭐</button>
                            <button type="button" class="icon-option modern-input p-3 text-center text-lg hover:bg-purple-600/30" data-icon="🎲">🎲</button>
                            <button type="button" class="icon-option modern-input p-3 text-center text-lg hover:bg-purple-600/30" data-icon="🔮">🔮</button>
                            <button type="button" class="icon-option modern-input p-3 text-center text-lg hover:bg-purple-600/30" data-icon="💫">💫</button>
                        </div>
                        <input type="hidden" id="selectedIcon" value="🕯️">
                    </div>
                </div>
                <div class="flex gap-3 mt-6">
                    <button id="saveCategory" class="pill-button flex-1 py-3 text-sm font-600" data-lang-key="save">
                        💾 SAVE
                    </button>
                    <button id="cancelCategory" class="language-toggle flex-1 py-3 text-sm font-600 rounded-full" data-lang-key="cancel">
                        ❌ CANCEL
                    </button>
                </div>
            </div>
        </div>

        <!-- Image Modal -->
        <div id="imageModal" class="modal-backdrop fixed top-0 left-0 w-full h-full flex items-center justify-center hidden z-50">
            <div class="modern-card p-6 soft-glow" style="max-width: 500px; width: 90%;">
                <div class="mb-6">
                    <h3 id="imageModalTitle" class="text-lg font-700 glow-text" data-lang-key="add-image-title">🖼️ ADD NEW IMAGE</h3>
                </div>
                <div class="space-y-4">
                    <div>
                        <label class="text-sm font-600 text-white block mb-2" data-lang-key="image-title">IMAGE TITLE:</label>
                        <input type="text" id="imageTitle" class="modern-input w-full p-4 text-sm font-500" data-lang-key="image-title-placeholder" placeholder="e.g., HAMMER PATTERN">
                    </div>
                    
                    <div>
                        <label class="text-sm font-600 text-white block mb-2" data-lang-key="image-source">IMAGE SOURCE:</label>
                        <div class="flex gap-2 mb-3">
                            <button type="button" id="urlSourceBtn" class="pill-button flex-1 py-2 text-xs font-600">
                                🔗 URL
                            </button>
                            <button type="button" id="fileSourceBtn" class="language-toggle flex-1 py-2 text-xs font-600 rounded-full">
                                📁 FILE
                            </button>
                        </div>
                        
                        <div id="urlSourceSection">
                            <input type="url" id="imageUrl" class="modern-input w-full p-4 text-sm font-500" data-lang-key="image-url-placeholder" placeholder="https://example.com/image.jpg">
                            <p class="text-xs text-purple-300 mt-2" data-lang-key="image-url-help">PASTE IMAGE URL FROM INTERNET</p>
                        </div>
                        
                        <div id="fileSourceSection" class="hidden">
                            <input type="file" id="imageFile" accept="image/*" class="modern-input w-full p-4 text-sm font-500">
                            <p class="text-xs text-purple-300 mt-2" data-lang-key="image-file-help">SELECT IMAGE FROM YOUR DEVICE</p>
                        </div>
                    </div>
                    
                    <div>
                        <label class="text-sm font-600 text-white block mb-2" data-lang-key="image-description">DESCRIPTION (OPTIONAL):</label>
                        <textarea id="imageDescription" class="modern-input w-full p-4 text-sm font-500" rows="3" data-lang-key="image-description-placeholder" placeholder="DESCRIBE THE TECHNIQUE..."></textarea>
                    </div>
                </div>
                <div class="flex gap-3 mt-6">
                    <button id="saveImage" class="pill-button flex-1 py-3 text-sm font-600" data-lang-key="save">
                        💾 SAVE
                    </button>
                    <button id="cancelImage" class="language-toggle flex-1 py-3 text-sm font-600 rounded-full" data-lang-key="cancel">
                        ❌ CANCEL
                    </button>
                </div>
            </div>
        </div>

        <!-- Full Screen Image Modal -->
        <div id="fullScreenModal" class="modal-backdrop fixed top-0 left-0 w-full h-full flex items-center justify-center hidden z-60">
            <div class="relative w-full h-full flex items-center justify-center p-4">
                <!-- Close Button -->
                <button id="closeFullScreen" class="absolute top-6 right-6 z-70 danger-glow text-white px-4 py-4 text-lg font-600 rounded-full hover:scale-110 transition-transform">
                    ✕
                </button>
                
                <!-- Image Container -->
                <div class="relative max-w-full max-h-full">
                    <img id="fullScreenImage" class="max-w-full max-h-full object-contain rounded-2xl shadow-2xl" alt="">
                    
                    <!-- Image Info -->
                    <div class="absolute bottom-0 left-0 right-0 modern-card p-4 m-4 backdrop-blur-lg">
                        <h3 id="fullScreenTitle" class="text-lg font-700 text-white mb-2"></h3>
                        <p id="fullScreenDescription" class="text-sm text-purple-300 font-400"></p>
                    </div>
                </div>
                
                <!-- Navigation Arrows (if multiple images) -->
                <button id="prevImage" class="absolute left-6 top-1/2 transform -translate-y-1/2 pill-button px-4 py-4 text-xl font-700 hidden">
                    ←
                </button>
                <button id="nextImage" class="absolute right-6 top-1/2 transform -translate-y-1/2 pill-button px-4 py-4 text-xl font-700 hidden">
                    →
                </button>
            </div>
        </div>

        <!-- Edit Record Modal -->
        <div id="editModal" class="modal-backdrop fixed top-0 left-0 w-full h-full flex items-center justify-center hidden z-50">
            <div class="modern-card p-6 soft-glow" style="max-width: 500px; width: 90%; max-height: 90vh; overflow-y: auto;">
                <div class="mb-6">
                    <h3 class="text-lg font-700 glow-text" data-lang-key="edit-trade-data">✏️ EDIT TRADE DATA</h3>
                </div>
                <div class="space-y-4">
                    <div>
                        <label class="text-sm font-600 text-white block mb-2" data-lang-key="order-type">ORDER TYPE:</label>
                        <select id="editOrderType" class="modern-input w-full p-4 text-sm font-500">
                            <option value="" data-lang-key="select-type">SELECT TYPE</option>
                            <option value="Buy" data-lang-key="buy">BUY</option>
                            <option value="Sell" data-lang-key="sell">SELL</option>
                        </select>
                    </div>
                    
                    <div>
                        <label class="text-sm font-600 text-white block mb-2" data-lang-key="target-tp">TARGET (TP):</label>
                        <input type="number" id="editTP" step="0.00001" class="modern-input w-full p-4 text-sm font-500" data-lang-key="target-price" placeholder="TARGET PRICE">
                    </div>
                    
                    <div>
                        <label class="text-sm font-600 text-white block mb-2" data-lang-key="result">RESULT:</label>
                        <select id="editResult" class="modern-input w-full p-4 text-sm font-500">
                            <option value="" data-lang-key="select-result">SELECT RESULT</option>
                            <option value="Win" data-lang-key="win">WIN</option>
                            <option value="Loss" data-lang-key="loss">LOSS</option>
                        </select>
                    </div>
                    
                    <div id="editProfitSection" class="hidden">
                        <label class="text-sm font-600 text-white block mb-2" data-lang-key="profit-amount">PROFIT AMOUNT:</label>
                        <input type="number" id="editProfitAmount" step="0.01" class="modern-input w-full p-4 text-sm font-500 bg-green-900/30" readonly>
                    </div>
                    
                    <div id="editLossSection" class="hidden">
                        <label class="text-sm font-600 text-white block mb-2" data-lang-key="loss-amount">LOSS AMOUNT:</label>
                        <input type="number" id="editLossAmount" step="0.01" class="modern-input w-full p-4 text-sm font-500 bg-red-900/30 mb-4" readonly>
                        
                        <label class="text-sm font-600 text-white block mb-2" data-lang-key="loss-reason">LOSS REASON:</label>
                        <select id="editLossReason" class="modern-input w-full p-4 text-sm font-500 mb-3">
                            <option value="" data-lang-key="select-reason">เลือกสาเหตุ</option>
                        </select>
                        
                        <div id="customLossReasonSection" class="hidden">
                            <label class="text-sm font-600 text-white block mb-2" data-lang-key="specify-reason">SPECIFY REASON:</label>
                            <textarea id="editCustomLossReason" class="modern-input w-full p-4 text-sm font-500" rows="3" data-lang-key="specify-reason" placeholder="SPECIFY REASON..."></textarea>
                        </div>
                    </div>
                    
                    <div id="editRRSection" class="hidden">
                        <label class="text-sm font-600 text-white block mb-2" data-lang-key="rr-ratio">R:R RATIO:</label>
                        <input type="text" id="editRR" class="modern-input w-full p-4 text-sm font-500 bg-purple-900/30" readonly>
                    </div>
                </div>
                <div class="flex gap-3 mt-6">
                    <button id="saveEdit" class="pill-button flex-1 py-3 text-sm font-600" data-lang-key="save">
                        💾 SAVE
                    </button>
                    <button id="cancelEdit" class="language-toggle py-3 text-sm font-600 px-4 rounded-full" data-lang-key="cancel">
                        ❌ CANCEL
                    </button>
                    <button id="deleteRecord" class="danger-glow py-3 text-sm font-600 px-4 rounded-full" data-lang-key="delete">
                        🗑️ DELETE
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Language system
        let currentLanguage = localStorage.getItem('language') || 'en';
        
        const translations = {
            en: {
                'app-title': 'HOPEYA TRADING',
                'app-subtitle': 'Modern Trading System',
                'app-features': '✅ Smart Checklist & 🧮 Advanced Calculator',
                'tab-checklist': 'CHECKLIST',
                'tab-checklist-short': 'LIST',
                'tab-calc': 'CALC',
                'tab-records': 'RECORDS',
                'tab-records-short': 'REC',
                'tab-stats': 'STATS',
                'daily-limit-title': '🚫 DAILY LIMIT REACHED!',
                'daily-limit-trades': '5 TRADES COMPLETED TODAY',
                'daily-limit-reset': 'RESET AT 06:00 AM',
                'daily-limit-discipline': 'DISCIPLINE = FREEDOM',
                'select-preset': '📋 SELECT PRESET',
                'new-preset': '➕ NEW',
                'choose-preset': '-- CHOOSE PRESET --',
                'edit-preset': '✏️ EDIT',
                'delete-preset': '🗑️ DELETE',
                'next-calculator': '🧮 NEXT: CALCULATOR →',
                'trading-type': 'SELECT TRADING TYPE:',
                'forex': 'FOREX',
                'crypto': 'CRYPTO',
                'forex-calculator': '🔢 FOREX CALCULATOR',
                'crypto-calculator': '₿ CRYPTO CALCULATOR',
                'calculate': '🧮 CALCULATE',
                'save-data': '💾 SAVE THIS DATA?',
                'save-confirm': '✅ SAVE',
                'save-skip': '❌ SKIP',
                'trade-records': '📝 TRADE RECORDS',
                'sort-new': '⬇️ NEW',
                'sort-old': '⬆️ OLD',
                'no-data': 'NO TRADING DATA',
                'trading-stats': '📊 TRADING STATS',
                'total': 'TOTAL',
                'win-rate': 'WIN RATE',
                'net-profit': 'NET PROFIT',
                'avg-rr': 'AVG R:R',
                'performance-chart': '📈 PERFORMANCE CHART',
                'preset-stats': '📋 PRESET STATS',
                'insufficient-data': 'INSUFFICIENT DATA',
                'no-preset-data': 'NO PRESET DATA',
                'win-streak': 'TOTAL WINS',
                'loss-streak': 'TOTAL LOSSES',
                'loss-reason-1': 'Didn\'t follow SL',
                'loss-reason-2': 'Wrong analysis',
                'loss-reason-3': 'News impact',
                'loss-reason-4': 'Wrong timing',
                'loss-reason-5': 'Market volatility',
                'loss-reason-6': 'Didn\'t follow plan',
                'loss-reason-7': 'Emotional trading',
                'loss-reason-8': 'Other',
                'tab-techniques': 'TECH',
                'techniques-title': '📚 TRADING TECHNIQUES',
                'add-category': '➕ ADD CATEGORY',
                'no-categories': 'NO CATEGORIES YET',
                'add-category-title': '📚 ADD NEW CATEGORY',
                'category-name': 'CATEGORY NAME:',
                'category-placeholder': 'e.g., CANDLESTICK PATTERNS',
                'category-icon': 'CATEGORY ICON:',
                'add-image-title': '🖼️ ADD NEW IMAGE',
                'image-title': 'IMAGE TITLE:',
                'image-title-placeholder': 'e.g., HAMMER PATTERN',
                'image-url': 'IMAGE URL:',
                'image-url-placeholder': 'https://example.com/image.jpg',
                'image-url-help': 'PASTE IMAGE URL FROM INTERNET',
                'image-description': 'DESCRIPTION (OPTIONAL):',
                'image-description-placeholder': 'DESCRIBE THE TECHNIQUE...',
                'add-image': '➕ ADD IMAGE',
                'edit-category': '✏️ EDIT',
                'delete-category': '🗑️ DELETE',
                'no-images': 'NO IMAGES IN THIS CATEGORY',
                'edit-image': '✏️',
                'delete-image': '🗑️',
                'image-source': 'IMAGE SOURCE:',
                'image-file-help': 'SELECT IMAGE FROM YOUR DEVICE'
            },
            th: {
                'app-title': 'HOPEYA TRADING',
                'app-subtitle': 'โปรแกรมเทรดสร้างวินัย',
                'app-features': '✅ เช็คลิสต์อัจฉริยะ & 🧮 เครื่องคิดเลขขั้นสูง',
                'tab-checklist': 'เช็คลิสต์',
                'tab-checklist-short': 'ลิสต์',
                'tab-calc': 'คำนวณ',
                'tab-records': 'บันทึก',
                'tab-records-short': 'บันทึก',
                'tab-stats': 'สถิติ',
                'daily-limit-title': '🚫 ถึงขีดจำกัดรายวัน!',
                'daily-limit-trades': 'เทรด 5 ครั้งวันนี้แล้ว',
                'daily-limit-reset': 'รีเซ็ตเวลา 06:00 น.',
                'daily-limit-discipline': 'วินัย = เสรีภาพ',
                'select-preset': '📋 เลือกเทมเพลต',
                'new-preset': '➕ สร้างใหม่',
                'choose-preset': '-- เลือกเทมเพลต --',
                'edit-preset': '✏️ แก้ไข',
                'delete-preset': '🗑️ ลบ',
                'next-calculator': '🧮 ถัดไป: เครื่องคิดเลข →',
                'trading-type': 'เลือกประเภทการเทรด:',
                'forex': 'ฟอเร็กซ์',
                'crypto': 'คริปโต',
                'forex-calculator': '🔢 เครื่องคิดเลขฟอเร็กซ์',
                'crypto-calculator': '₿ เครื่องคิดเลขคริปโต',
                'calculate': '🧮 คำนวณ',
                'save-data': '💾 บันทึกข้อมูลนี้?',
                'save-confirm': '✅ บันทึก',
                'save-skip': '❌ ข้าม',
                'trade-records': '📝 บันทึกการเทรด',
                'sort-new': '⬇️ ใหม่',
                'sort-old': '⬆️ เก่า',
                'no-data': 'ไม่มีข้อมูลการเทรด',
                'trading-stats': '📊 สถิติการเทรด',
                'total': 'ทั้งหมด',
                'win-rate': 'อัตราชนะ',
                'net-profit': 'กำไรสุทธิ',
                'avg-rr': 'อาร์อาร์ เฉลี่ย',
                'performance-chart': '📈 กราฟผลงาน',
                'preset-stats': '📋 สถิติเทมเพลต',
                'insufficient-data': 'ข้อมูลไม่เพียงพอ',
                'no-preset-data': 'ไม่มีข้อมูลเทมเพลต',
                'win-streak': 'ชนะทั้งหมด',
                'loss-streak': 'แพ้ทั้งหมด',
                'forex-results': 'ผลลัพธ์ฟอเร็กซ์',
                'crypto-results': 'ผลลัพธ์คริปโต',
                'pair': 'คู่เงิน',
                'coin': 'เหรียญ',
                'entry': 'ราคาเข้า',
                'sl': 'สต็อปลอส',
                'tp': 'เทคโปรฟิต',
                'leverage': 'เลเวอเรจ',
                'standard-lots': 'ล็อตมาตรฐาน',
                'micro-lots': 'ไมโครล็อต',
                'margin-needed': 'มาร์จิ้นที่ต้องใช้',
                'risk-amount': 'จำนวนเสี่ยง',
                'tip-message': '💡 เคล็ดลับ: ตั้งเป้าหมายที่อัตราส่วน 1:2 หรือสูงกว่า',
                'warning-high-risk': '⚠️ คำเตือน: ความเสี่ยงสูงเกินไป!',
                'results-title': 'ผลลัพธ์',
                'win-badge': 'ชนะ',
                'loss-badge': 'แพ้',
                'pending-badge': 'รอผล',
                'complete-badge': 'สมบูรณ์',
                'incomplete-badge': 'ไม่สมบูรณ์',
                'no-checklist-badge': 'ไม่มีเช็คลิสต์',
                'pending-status': 'รอผล',
                'edit-trade': 'แก้ไขเทรด',
                'edit-trade-data': 'แก้ไขข้อมูลการเทรด',
                'order-type': 'ประเภทออเดอร์',
                'select-type': 'เลือกประเภท',
                'buy': 'ซื้อ',
                'sell': 'ขาย',
                'target-tp': 'เป้าหมาย (TP)',
                'target-price': 'ราคาเป้าหมาย',
                'result': 'ผลลัพธ์',
                'select-result': 'เลือกผลลัพธ์',
                'win': 'ชนะ',
                'loss': 'แพ้',
                'profit-amount': 'จำนวนกำไร',
                'loss-amount': 'จำนวนขาดทุน',
                'loss-reason': 'สาเหตุการขาดทุน',
                'select-reason': 'เลือกสาเหตุ',
                'specify-reason': 'ระบุสาเหตุ...',
                'rr-ratio': 'อัตราส่วน R:R',
                'save': 'บันทึก',
                'cancel': 'ยกเลิก',
                'delete': 'ลบ',
                'loss-reason-1': 'ไม่ทำตาม SL',
                'loss-reason-2': 'วิเคราะห์ผิด',
                'loss-reason-3': 'ข่าวกระทบ',
                'loss-reason-4': 'เข้าจังหวะผิด',
                'loss-reason-5': 'ตลาดผันผวน',
                'loss-reason-6': 'ไม่ทำตามแผน',
                'loss-reason-7': 'อารมณ์เข้ามาเกี่ยว',
                'loss-reason-8': 'อื่นๆ',
                'tab-techniques': 'เทคนิค',
                'techniques-title': '📚 เทคนิคการเทรด',
                'add-category': '➕ เพิ่มหมวดหมู่',
                'no-categories': 'ยังไม่มีหมวดหมู่',
                'add-category-title': '📚 เพิ่มหมวดหมู่ใหม่',
                'category-name': 'ชื่อหมวดหมู่:',
                'category-placeholder': 'เช่น รูปแบบแท่งเทียน',
                'category-icon': 'ไอคอนหมวดหมู่:',
                'add-image-title': '🖼️ เพิ่มรูปภาพใหม่',
                'image-title': 'ชื่อรูปภาพ:',
                'image-title-placeholder': 'เช่น แพทเทิร์น Hammer',
                'image-url': 'URL รูปภาพ:',
                'image-url-placeholder': 'https://example.com/image.jpg',
                'image-url-help': 'วาง URL รูปภาพจากอินเทอร์เน็ต',
                'image-description': 'คำอธิบาย (ไม่บังคับ):',
                'image-description-placeholder': 'อธิบายเทคนิค...',
                'add-image': '➕ เพิ่มรูป',
                'edit-category': '✏️ แก้ไข',
                'delete-category': '🗑️ ลบ',
                'no-images': 'ไม่มีรูปในหมวดหมู่นี้',
                'edit-image': '✏️',
                'delete-image': '🗑️',
                'image-source': 'แหล่งรูปภาพ:',
                'image-file-help': 'เลือกรูปภาพจากเครื่องของคุณ'
            }
        };
        
        function updateLanguage() {
            const lang = translations[currentLanguage];
            document.querySelectorAll('[data-lang-key]').forEach(element => {
                const key = element.getAttribute('data-lang-key');
                if (lang[key]) {
                    element.textContent = lang[key];
                }
            });
            
            // Update current language display
            document.getElementById('currentLang').textContent = currentLanguage.toUpperCase();
            
            // Update loss reason dropdown if it exists
            updateLossReasonDropdown();
        }
        
        function updateLossReasonDropdown() {
            const lossReasonSelect = document.getElementById('editLossReason');
            if (!lossReasonSelect) return;
            
            const lang = translations[currentLanguage];
            
            // Clear existing options except the first one
            lossReasonSelect.innerHTML = `<option value="" data-lang-key="select-reason">${lang['select-reason']}</option>`;
            
            // Add loss reason options based on current language
            const lossReasons = [
                { key: 'loss-reason-1', value: currentLanguage === 'en' ? 'Didn\'t follow SL' : 'ไม่ทำตาม SL' },
                { key: 'loss-reason-2', value: currentLanguage === 'en' ? 'Wrong analysis' : 'วิเคราะห์ผิด' },
                { key: 'loss-reason-3', value: currentLanguage === 'en' ? 'News impact' : 'ข่าวกระทบ' },
                { key: 'loss-reason-4', value: currentLanguage === 'en' ? 'Wrong timing' : 'เข้าจังหวะผิด' },
                { key: 'loss-reason-5', value: currentLanguage === 'en' ? 'Market volatility' : 'ตลาดผันผวน' },
                { key: 'loss-reason-6', value: currentLanguage === 'en' ? 'Didn\'t follow plan' : 'ไม่ทำตามแผน' },
                { key: 'loss-reason-7', value: currentLanguage === 'en' ? 'Emotional trading' : 'อารมณ์เข้ามาเกี่ยว' },
                { key: 'loss-reason-8', value: currentLanguage === 'en' ? 'Other' : 'อื่นๆ' }
            ];
            
            lossReasons.forEach(reason => {
                const option = document.createElement('option');
                option.value = reason.value;
                option.textContent = reason.value;
                lossReasonSelect.appendChild(option);
            });
        }
        
        function toggleLanguage() {
            currentLanguage = currentLanguage === 'en' ? 'th' : 'en';
            localStorage.setItem('language', currentLanguage);
            updateLanguage();
        }
        
        // Language toggle event
        document.getElementById('languageToggle').addEventListener('click', toggleLanguage);

        const pipSettings = {
            // 🔹 คู่เงินหลัก (USD pairs, pip = 0.0001) → pipValue ต่อ 1.0 lot = 10 USD
            "EURUSD": { multiplier: 10000, pipValue: 10 },
            "GBPUSD": { multiplier: 10000, pipValue: 10 },
            "AUDUSD": { multiplier: 10000, pipValue: 10 },
            "NZDUSD": { multiplier: 10000, pipValue: 10 },
            "USDCHF": { multiplier: 10000, pipValue: 10 },
            "USDCAD": { multiplier: 10000, pipValue: 10 },

            // 🔸 คู่เงินที่มี JPY (JPY pairs, pip = 0.01) → ปรับ pipValue ตามสูตรใหม่
            "USDJPY": { multiplier: 100, pipValue: 7.0 },
            "EURJPY": { multiplier: 100, pipValue: 7.2 },
            "GBPJPY": { multiplier: 100, pipValue: 7.5 },
            "AUDJPY": { multiplier: 100, pipValue: 7.0 },
            "NZDJPY": { multiplier: 100, pipValue: 6.8 },
            "CADJPY": { multiplier: 100, pipValue: 7.1 },

            // 🟡 ทองคำ (XAUUSD) → ราคาขยับ 1.00 = 100 USD
            "XAUUSD": { multiplier: 1, pipValue: 100 },

            // ⚪ เงิน (XAGUSD) → ราคาขยับ 1.00 = ~50 USD
            "XAGUSD": { multiplier: 1, pipValue: 50 },

            // 🛢 น้ำมัน (USOIL, UKOIL) → ราคาขยับ 1.00 = 10 USD
            "USOIL": { multiplier: 1, pipValue: 10 },
            "UKOIL": { multiplier: 1, pipValue: 10 },

            // 📊 ดัชนี → ราคาขยับ 1.00 = 1 USD
            "US30": { multiplier: 1, pipValue: 1 },
            "NAS100": { multiplier: 1, pipValue: 1 },
            "SPX500": { multiplier: 1, pipValue: 1 }
        };

        let currentMode = 'forex';
        let currentPage = 'checklist';
        let currentCalculationData = null;
        let currentEditingId = null;
        let currentEditingPresetId = null;
        let activePresetId = null;
        let tradingRecords = JSON.parse(localStorage.getItem('tradingRecords') || '[]');
        let checklistPresets = JSON.parse(localStorage.getItem('checklistPresets') || '[]');
        let checklistStates = JSON.parse(localStorage.getItem('checklistStates') || '{}');
        let sortOrder = 'newest';
        let techniqueCategories = JSON.parse(localStorage.getItem('techniqueCategories') || '[]');
        let currentEditingCategoryId = null;
        let currentEditingImageId = null;
        let currentCategoryId = null;

        // Default presets if none exist
        if (checklistPresets.length === 0) {
            checklistPresets = [
                {
                    id: 1,
                    name: "PRE-TRADE CHECKLIST",
                    items: [
                        "CHECK IMPORTANT NEWS",
                        "ANALYZE CHART & TREND",
                        "SET ENTRY & EXIT POINTS",
                        "CALCULATE RISK MANAGEMENT",
                        "CHECK MENTAL STATE"
                    ]
                }
            ];
            localStorage.setItem('checklistPresets', JSON.stringify(checklistPresets));
        }

        // Check daily limit
        function checkDailyLimit() {
            const today = new Date().toDateString();
            const todayRecords = tradingRecords.filter(record => 
                new Date(record.date).toDateString() === today
            );
            
            if (todayRecords.length >= 5) {
                const now = new Date();
                const tomorrow6AM = new Date();
                tomorrow6AM.setDate(tomorrow6AM.getDate() + 1);
                tomorrow6AM.setHours(6, 0, 0, 0);
                
                if (now < tomorrow6AM) {
                    document.getElementById('dailyLimitWarning').classList.remove('hidden');
                    document.getElementById('calculatorTab').disabled = true;
                    document.getElementById('calculatorTab').classList.add('opacity-50');
                    return true;
                }
            }
            return false;
        }

        // Navigation
        document.getElementById('checklistTab').addEventListener('click', () => {
            switchPage('checklist');
        });

        document.getElementById('calculatorTab').addEventListener('click', () => {
            if (checkDailyLimit()) return;
            switchPage('calculator');
        });

        document.getElementById('recordsTab').addEventListener('click', () => {
            switchPage('records');
        });

        document.getElementById('statsTab').addEventListener('click', () => {
            switchPage('stats');
        });

        document.getElementById('techniquesTab').addEventListener('click', () => {
            switchPage('techniques');
        });

        // Next page button
        document.getElementById('nextToCalculator').addEventListener('click', () => {
            if (checkDailyLimit()) return;
            switchPage('calculator');
        });

        function switchPage(page) {
            currentPage = page;
            
            // Update navigation
            document.querySelectorAll('#checklistTab, #calculatorTab, #recordsTab, #statsTab, #techniquesTab').forEach(btn => {
                btn.className = 'tab-inactive px-4 py-3 text-xs font-600 flex-shrink-0 min-w-[80px]';
            });
            
            // Hide all pages
            document.getElementById('checklistPage').classList.add('hidden');
            document.getElementById('calculatorPage').classList.add('hidden');
            document.getElementById('recordsPage').classList.add('hidden');
            document.getElementById('statsPage').classList.add('hidden');
            document.getElementById('techniquesPage').classList.add('hidden');
            
            if (page === 'checklist') {
                document.getElementById('checklistTab').className = 'tab-active px-4 py-3 text-xs font-600 flex-shrink-0 min-w-[80px]';
                document.getElementById('checklistPage').classList.remove('hidden');
                loadPresets();
            } else if (page === 'calculator') {
                document.getElementById('calculatorTab').className = 'tab-active px-4 py-3 text-xs font-600 flex-shrink-0 min-w-[80px]';
                document.getElementById('calculatorPage').classList.remove('hidden');
            } else if (page === 'records') {
                document.getElementById('recordsTab').className = 'tab-active px-4 py-3 text-xs font-600 flex-shrink-0 min-w-[80px]';
                document.getElementById('recordsPage').classList.remove('hidden');
                loadRecords();
            } else if (page === 'stats') {
                document.getElementById('statsTab').className = 'tab-active px-4 py-3 text-xs font-600 flex-shrink-0 min-w-[80px]';
                document.getElementById('statsPage').classList.remove('hidden');
                loadStats();
            } else if (page === 'techniques') {
                document.getElementById('techniquesTab').className = 'tab-active px-4 py-3 text-xs font-600 flex-shrink-0 min-w-[80px]';
                document.getElementById('techniquesPage').classList.remove('hidden');
                loadTechniques();
            }
        }

        // Preset Management
        function loadPresets() {
            const presetSelector = document.getElementById('presetSelector');
            const presetActions = document.getElementById('presetActions');
            
            // Clear existing options
            presetSelector.innerHTML = '<option value="">-- CHOOSE PRESET --</option>';
            
            if (checklistPresets.length === 0) {
                presetActions.classList.add('hidden');
                return;
            }

            // Populate dropdown options
            checklistPresets.forEach(preset => {
                const option = document.createElement('option');
                option.value = preset.id;
                option.textContent = `${preset.name} (${preset.items.length} ITEMS)`;
                presetSelector.appendChild(option);
            });

            // Set selected value if there's an active preset
            if (activePresetId) {
                presetSelector.value = activePresetId;
                presetActions.classList.remove('hidden');
                loadActiveChecklist();
            } else {
                presetActions.classList.add('hidden');
            }
        }

        function selectPreset(presetId) {
            activePresetId = presetId;
            localStorage.setItem('activePresetId', presetId);
            loadPresets();
            loadActiveChecklist();
        }

        // Preset selector event listener
        document.getElementById('presetSelector').addEventListener('change', (e) => {
            const selectedId = parseInt(e.target.value);
            if (selectedId) {
                selectPreset(selectedId);
                document.getElementById('presetActions').classList.remove('hidden');
            } else {
                activePresetId = null;
                localStorage.removeItem('activePresetId');
                document.getElementById('presetActions').classList.add('hidden');
                document.getElementById('activeChecklistSection').classList.add('hidden');
            }
        });

        // Preset action buttons
        document.getElementById('editSelectedPreset').addEventListener('click', () => {
            if (activePresetId) {
                editPreset(activePresetId);
            }
        });

        document.getElementById('deleteSelectedPreset').addEventListener('click', () => {
            if (activePresetId) {
                deletePreset(activePresetId);
            }
        });

        function loadActiveChecklist() {
            const preset = checklistPresets.find(p => p.id === activePresetId);
            if (!preset) return;

            document.getElementById('activePresetName').textContent = preset.name;
            document.getElementById('activeChecklistSection').classList.remove('hidden');

            const checklistItems = document.getElementById('checklistItems');
            const currentState = checklistStates[activePresetId] || {};

            const itemsHTML = preset.items.map((item, index) => {
                const isChecked = currentState[index] || false;
                return `
                    <div class="checklist-item ${isChecked ? 'completed' : ''} p-4 cursor-pointer" onclick="toggleChecklistItem(${index})">
                        <div class="flex items-center gap-4">
                            <div class="modern-checkbox ${isChecked ? 'checked' : ''}"></div>
                            <span class="text-sm font-500 flex-1 ${isChecked ? 'line-through' : ''}">${item}</span>
                            <span class="text-lg">${isChecked ? '✅' : '⬜'}</span>
                        </div>
                    </div>
                `;
            }).join('');

            checklistItems.innerHTML = itemsHTML;
            updateProgress();
        }

        function toggleChecklistItem(index) {
            if (!checklistStates[activePresetId]) {
                checklistStates[activePresetId] = {};
            }
            
            checklistStates[activePresetId][index] = !checklistStates[activePresetId][index];
            localStorage.setItem('checklistStates', JSON.stringify(checklistStates));
            
            loadActiveChecklist();
        }

        function updateProgress() {
            const preset = checklistPresets.find(p => p.id === activePresetId);
            if (!preset) return;

            const currentState = checklistStates[activePresetId] || {};
            const completed = Object.values(currentState).filter(Boolean).length;
            const total = preset.items.length;
            const percentage = total > 0 ? (completed / total) * 100 : 0;

            document.getElementById('progressText').textContent = `${completed}/${total}`;
            document.getElementById('progressBar').style.width = `${percentage}%`;
        }

        // Preset CRUD Operations
        document.getElementById('createPresetBtn').addEventListener('click', () => {
            if (checklistPresets.length >= 3) {
                alert('MAX 3 PRESETS ALLOWED');
                return;
            }
            openPresetModal();
        });

        function editPreset(presetId) {
            const preset = checklistPresets.find(p => p.id === presetId);
            if (!preset) return;
            
            currentEditingPresetId = presetId;
            openPresetModal(preset);
        }

        function deletePreset(presetId) {
            if (confirm('DELETE THIS PRESET?')) {
                checklistPresets = checklistPresets.filter(p => p.id !== presetId);
                delete checklistStates[presetId];
                
                if (activePresetId === presetId) {
                    activePresetId = null;
                    localStorage.removeItem('activePresetId');
                    document.getElementById('activeChecklistSection').classList.add('hidden');
                    document.getElementById('presetActions').classList.add('hidden');
                }
                
                localStorage.setItem('checklistPresets', JSON.stringify(checklistPresets));
                localStorage.setItem('checklistStates', JSON.stringify(checklistStates));
                loadPresets();
            }
        }

        function openPresetModal(preset = null) {
            const modal = document.getElementById('presetModal');
            const title = document.getElementById('presetModalTitle');
            const nameInput = document.getElementById('presetName');
            const itemsEditor = document.getElementById('checklistItemsEditor');

            if (preset) {
                title.textContent = '✏️ EDIT PRESET';
                nameInput.value = preset.name;
                
                itemsEditor.innerHTML = preset.items.map(item => `
                    <div class="flex gap-3">
                        <input type="text" class="modern-input flex-1 p-4 text-sm font-500" value="${item}">
                        <button class="remove-item danger-glow text-white px-4 py-4 text-sm font-600 rounded-2xl">🗑️</button>
                    </div>
                `).join('');
            } else {
                title.textContent = '📋 CREATE NEW PRESET';
                nameInput.value = '';
                
                itemsEditor.innerHTML = `
                    <div class="flex gap-3">
                        <input type="text" class="modern-input flex-1 p-4 text-sm font-500" placeholder="ITEM 1">
                        <button class="remove-item danger-glow text-white px-4 py-4 text-sm font-600 rounded-2xl">🗑️</button>
                    </div>
                `;
            }

            modal.classList.remove('hidden');
            setupItemEditor();
        }

        function setupItemEditor() {
            // Add item button
            document.getElementById('addItemBtn').onclick = () => {
                const itemsEditor = document.getElementById('checklistItemsEditor');
                const newItem = document.createElement('div');
                newItem.className = 'flex gap-3';
                newItem.innerHTML = `
                    <input type="text" class="modern-input flex-1 p-4 text-sm font-500" placeholder="NEW ITEM">
                    <button class="remove-item danger-glow text-white px-4 py-4 text-sm font-600 rounded-2xl">🗑️</button>
                `;
                itemsEditor.appendChild(newItem);
                setupRemoveButtons();
            };

            setupRemoveButtons();
        }

        function setupRemoveButtons() {
            document.querySelectorAll('.remove-item').forEach(btn => {
                btn.onclick = (e) => {
                    const itemsEditor = document.getElementById('checklistItemsEditor');
                    if (itemsEditor.children.length > 1) {
                        e.target.parentElement.remove();
                    } else {
                        alert('NEED AT LEAST 1 ITEM');
                    }
                };
            });
        }

        // Save preset
        document.getElementById('savePreset').addEventListener('click', () => {
            const name = document.getElementById('presetName').value.trim();
            const itemInputs = document.querySelectorAll('#checklistItemsEditor input');
            const items = Array.from(itemInputs).map(input => input.value.trim()).filter(item => item);

            if (!name) {
                alert('ENTER PRESET NAME');
                return;
            }

            if (items.length === 0) {
                alert('NEED AT LEAST 1 ITEM');
                return;
            }

            if (currentEditingPresetId) {
                // Edit existing preset
                const presetIndex = checklistPresets.findIndex(p => p.id === currentEditingPresetId);
                if (presetIndex !== -1) {
                    checklistPresets[presetIndex] = {
                        ...checklistPresets[presetIndex],
                        name,
                        items
                    };
                }
                currentEditingPresetId = null;
            } else {
                // Create new preset
                const newPreset = {
                    id: Date.now(),
                    name,
                    items
                };
                checklistPresets.push(newPreset);
            }

            localStorage.setItem('checklistPresets', JSON.stringify(checklistPresets));
            document.getElementById('presetModal').classList.add('hidden');
            loadPresets();
        });

        // Cancel preset
        document.getElementById('cancelPreset').addEventListener('click', () => {
            document.getElementById('presetModal').classList.add('hidden');
            currentEditingPresetId = null;
        });

        // Reset checklist
        document.getElementById('resetChecklist').addEventListener('click', () => {
            if (activePresetId && confirm('RESET CHECKLIST?')) {
                delete checklistStates[activePresetId];
                localStorage.setItem('checklistStates', JSON.stringify(checklistStates));
                loadActiveChecklist();
                alert('CHECKLIST RESET!');
            }
        });

        // Edit active preset
        document.getElementById('editActivePreset').addEventListener('click', () => {
            if (activePresetId) {
                editPreset(activePresetId);
            }
        });

        // Trading type selection
        document.getElementById('forexBtn').addEventListener('click', () => {
            currentMode = 'forex';
            document.getElementById('forexBtn').className = 'pill-button py-6 text-center';
            document.getElementById('cryptoBtn').className = 'tab-inactive py-6 text-center border border-purple-500/30 rounded-3xl';
            document.getElementById('forexCalculator').classList.remove('hidden');
            document.getElementById('cryptoCalculator').classList.add('hidden');
            document.getElementById('results').classList.add('hidden');
        });

        document.getElementById('cryptoBtn').addEventListener('click', () => {
            currentMode = 'crypto';
            document.getElementById('cryptoBtn').className = 'pill-button py-6 text-center';
            document.getElementById('forexBtn').className = 'tab-inactive py-6 text-center border border-purple-500/30 rounded-3xl';
            document.getElementById('cryptoCalculator').classList.remove('hidden');
            document.getElementById('forexCalculator').classList.add('hidden');
            document.getElementById('results').classList.add('hidden');
        });

        // Calculate function
        document.getElementById('calculateBtn').addEventListener('click', () => {
            if (checkDailyLimit()) return;
            
            if (currentMode === 'forex') {
                calculateForex();
            } else {
                calculateCrypto();
            }
        });

        function calculateForex() {
            const currencyPair = document.getElementById('currencyPair').value;
            const accountCurrency = document.getElementById('accountCurrency').value;
            const entryPrice = parseFloat(document.getElementById('entryPrice').value);
            const stopLoss = parseFloat(document.getElementById('stopLoss').value);
            const accountBalance = parseFloat(document.getElementById('accountBalance').value);
            const riskPercent = parseFloat(document.getElementById('riskPercent').value);

            if (!entryPrice || !stopLoss || !accountBalance || !riskPercent) {
                alert('FILL ALL FIELDS');
                return;
            }

            const pipSetting = pipSettings[currencyPair];
            const riskAmount = (accountBalance * riskPercent) / 100;
            const pipDifference = Math.abs(entryPrice - stopLoss) * pipSetting.multiplier;
            const lotSize = riskAmount / (pipDifference * pipSetting.pipValue);

            let standardLots = lotSize;
            let microLots = lotSize * 100;

            // Store calculation data for saving
            currentCalculationData = {
                type: 'forex',
                currencyPair,
                accountCurrency,
                entryPrice,
                stopLoss,
                accountBalance,
                riskPercent,
                riskAmount,
                lotSize: standardLots,
                microLots: accountCurrency === 'CENT' ? microLots : null
            };

            let resultHTML = `
                <div class="modern-card p-4 mb-4" style="background: rgba(139, 92, 246, 0.1);">
                    <h4 class="text-sm font-700 text-white mb-3" data-lang-key="forex-results">📈 FOREX RESULTS</h4>
                    <p class="text-sm text-white mb-2"><strong data-lang-key="pair">PAIR:</strong> ${currencyPair}</p>
                    <p class="text-sm text-white mb-2"><strong data-lang-key="entry">ENTRY:</strong> ${entryPrice}</p>
                    <p class="text-sm text-white"><strong data-lang-key="sl">SL:</strong> ${stopLoss}</p>
                </div>
                
                <div class="space-y-4 mb-4">
                    <div class="flex justify-between items-center p-4 stat-card">
                        <span class="text-sm font-600 text-white" data-lang-key="standard-lots">STANDARD LOTS:</span>
                        <span class="text-sm font-700 glow-text">${standardLots.toFixed(2)}</span>
                    </div>
            `;

            if (accountCurrency === 'CENT') {
                resultHTML += `
                    <div class="flex justify-between items-center p-4 stat-card">
                        <span class="text-sm font-600 text-white" data-lang-key="micro-lots">MICRO LOTS:</span>
                        <span class="text-sm font-700 glow-text">${microLots.toFixed(2)}</span>
                    </div>
                `;
            }

            resultHTML += `
                    <div class="flex justify-between items-center p-4 stat-card">
                        <span class="text-sm font-600 text-white" data-lang-key="risk-amount">RISK AMOUNT:</span>
                        <span class="text-sm font-700 text-red-400">${riskAmount.toFixed(2)} ${accountCurrency}</span>
                    </div>
                </div>
                
                <div class="success-glow modern-card p-4 mb-4">
                    <p class="text-sm font-600 text-white" data-lang-key="tip-message">💡 TIP: SET TP AT 1:2 RATIO OR HIGHER</p>
                </div>
            `;

            if (riskPercent > 30) {
                resultHTML += `
                    <div class="danger-glow modern-card p-4">
                        <p class="text-sm font-700 text-white" data-lang-key="warning-high-risk">⚠️ WARNING: RISK TOO HIGH!</p>
                    </div>
                `;
            }

            document.getElementById('resultContent').innerHTML = resultHTML;
            document.getElementById('results').classList.remove('hidden');
            document.getElementById('saveConfirmation').classList.remove('hidden');
            
            // Update language for dynamically added content
            updateLanguage();
        }

        function calculateCrypto() {
            const cryptoCoin = document.getElementById('cryptoCoin').value;
            const entryPrice = parseFloat(document.getElementById('cryptoEntryPrice').value);
            const stopLoss = parseFloat(document.getElementById('cryptoStopLoss').value);
            const accountBalance = parseFloat(document.getElementById('cryptoAccountBalance').value);
            const leverage = parseFloat(document.getElementById('leverage').value);
            const riskPercent = parseFloat(document.getElementById('cryptoRiskPercent').value);

            if (!entryPrice || !stopLoss || !accountBalance || !leverage || !riskPercent) {
                alert('FILL ALL FIELDS');
                return;
            }

            const riskAmount = (accountBalance * riskPercent) / 100;
            const priceRiskPercent = Math.abs(entryPrice - stopLoss) / entryPrice;
            const margin = riskAmount / (priceRiskPercent * leverage);

            // Store calculation data for saving
            currentCalculationData = {
                type: 'crypto',
                cryptoCoin,
                entryPrice,
                stopLoss,
                accountBalance,
                leverage,
                riskPercent,
                riskAmount,
                margin
            };

            let resultHTML = `
                <div class="modern-card p-4 mb-4" style="background: rgba(245, 158, 11, 0.1);">
                    <h4 class="text-sm font-700 text-white mb-3" data-lang-key="crypto-results">₿ CRYPTO RESULTS</h4>
                    <p class="text-sm text-white mb-2"><strong data-lang-key="coin">COIN:</strong> ${cryptoCoin}</p>
                    <p class="text-sm text-white mb-2"><strong data-lang-key="entry">ENTRY:</strong> ${entryPrice}</p>
                    <p class="text-sm text-white mb-2"><strong data-lang-key="sl">SL:</strong> ${stopLoss}</p>
                    <p class="text-sm text-white"><strong data-lang-key="leverage">LEVERAGE:</strong> ${leverage}X</p>
                </div>
                
                <div class="space-y-4 mb-4">
                    <div class="flex justify-between items-center p-4 stat-card">
                        <span class="text-sm font-600 text-white" data-lang-key="margin-needed">MARGIN NEEDED:</span>
                        <span class="text-sm font-700 glow-text">${margin.toFixed(2)} USDT</span>
                    </div>
                    <div class="flex justify-between items-center p-4 stat-card">
                        <span class="text-sm font-600 text-white" data-lang-key="risk-amount">RISK AMOUNT:</span>
                        <span class="text-sm font-700 text-red-400">${riskAmount.toFixed(2)} USDT</span>
                    </div>
                </div>
                
                <div class="success-glow modern-card p-4 mb-4">
                    <p class="text-sm font-600 text-white" data-lang-key="tip-message">💡 TIP: SET TP AT 1:2 RATIO OR HIGHER</p>
                </div>
            `;

            if (riskPercent > 30) {
                resultHTML += `
                    <div class="danger-glow modern-card p-4">
                        <p class="text-sm font-700 text-white" data-lang-key="warning-high-risk">⚠️ WARNING: RISK TOO HIGH!</p>
                    </div>
                `;
            }

            document.getElementById('resultContent').innerHTML = resultHTML;
            document.getElementById('results').classList.remove('hidden');
            document.getElementById('saveConfirmation').classList.remove('hidden');
            
            // Update language for dynamically added content
            updateLanguage();
        }

        // Save confirmation handlers
        document.getElementById('confirmSave').addEventListener('click', () => {
            if (currentCalculationData) {
                // Check checklist status
                let checklistStatus = null;
                let checklistProgress = null;
                
                if (activePresetId) {
                    const preset = checklistPresets.find(p => p.id === activePresetId);
                    if (preset) {
                        const currentState = checklistStates[activePresetId] || {};
                        const completed = Object.values(currentState).filter(Boolean).length;
                        const total = preset.items.length;
                        
                        checklistStatus = completed === total ? 'complete' : 'incomplete';
                        checklistProgress = `${completed}/${total}`;
                    }
                }
                
                const record = {
                    id: Date.now(),
                    date: new Date().toISOString(),
                    ...currentCalculationData,
                    orderType: null,
                    tp: null,
                    result: null,
                    profitAmount: null,
                    rr: null,
                    checklistStatus,
                    checklistProgress,
                    presetId: activePresetId
                };
                
                tradingRecords.push(record);
                localStorage.setItem('tradingRecords', JSON.stringify(tradingRecords));
                
                // Reset checklist after saving
                if (activePresetId) {
                    delete checklistStates[activePresetId];
                    localStorage.setItem('checklistStates', JSON.stringify(checklistStates));
                }
                
                // Reset form
                resetCalculatorForm();
                document.getElementById('saveConfirmation').classList.add('hidden');
                document.getElementById('results').classList.add('hidden');
                
                alert('DATA SAVED! CHECKLIST RESET!');
            }
        });

        document.getElementById('cancelSave').addEventListener('click', () => {
            document.getElementById('saveConfirmation').classList.add('hidden');
        });

        function resetCalculatorForm() {
            if (currentMode === 'forex') {
                document.getElementById('entryPrice').value = '';
                document.getElementById('stopLoss').value = '';
                document.getElementById('accountBalance').value = '';
                document.getElementById('riskPercent').value = '';
            } else {
                document.getElementById('cryptoEntryPrice').value = '';
                document.getElementById('cryptoStopLoss').value = '';
                document.getElementById('cryptoAccountBalance').value = '';
                document.getElementById('leverage').value = '';
                document.getElementById('cryptoRiskPercent').value = '';
            }
        }

        // Sort button handlers
        document.getElementById('sortNewest').addEventListener('click', () => {
            sortOrder = 'newest';
            updateSortButtons();
            loadRecords();
        });

        document.getElementById('sortOldest').addEventListener('click', () => {
            sortOrder = 'oldest';
            updateSortButtons();
            loadRecords();
        });

        function updateSortButtons() {
            document.querySelectorAll('.sort-btn').forEach(btn => {
                btn.className = 'sort-btn language-toggle px-3 py-2 text-sm font-600';
            });
            
            if (sortOrder === 'newest') {
                document.getElementById('sortNewest').className = 'sort-btn pill-button px-3 py-2 text-sm font-600';
            } else {
                document.getElementById('sortOldest').className = 'sort-btn pill-button px-3 py-2 text-sm font-600';
            }
        }

        // Load records
        function loadRecords() {
            const recordsList = document.getElementById('recordsList');
            
            if (tradingRecords.length === 0) {
                recordsList.innerHTML = '<p class="text-center py-8 text-purple-300 text-sm font-400">NO TRADING DATA</p>';
                return;
            }

            // Sort records based on current sort order
            const sortedRecords = [...tradingRecords].sort((a, b) => {
                if (sortOrder === 'newest') {
                    return new Date(b.date) - new Date(a.date); // Newest first
                } else {
                    return new Date(a.date) - new Date(b.date); // Oldest first
                }
            });

            const recordsHTML = sortedRecords.map(record => {
                const date = new Date(record.date).toLocaleDateString('th-TH');
                const time = new Date(record.date).toLocaleTimeString('th-TH', { hour: '2-digit', minute: '2-digit' });
                
                let statusBadge = '';
                let accentClass = '';
                if (record.result === 'Win') {
                    statusBadge = '<span class="badge-modern badge-success px-3 py-1 text-xs font-600" data-lang-key="win-badge">WIN</span>';
                    accentClass = 'win-accent';
                } else if (record.result === 'Loss') {
                    statusBadge = '<span class="badge-modern badge-danger px-3 py-1 text-xs font-600" data-lang-key="loss-badge">LOSS</span>';
                    accentClass = 'loss-accent';
                } else {
                    statusBadge = '<span class="badge-modern badge-warning px-3 py-1 text-xs font-600" data-lang-key="pending-badge">PENDING</span>';
                    accentClass = 'pending-accent';
                }

                // Add checklist status badge
                let checklistBadge = '';
                if (record.checklistStatus === 'complete') {
                    checklistBadge = '<span class="badge-modern badge-success px-3 py-1 text-xs font-500" data-lang-key="complete-badge">✅ COMPLETE</span>';
                } else if (record.checklistStatus === 'incomplete') {
                    checklistBadge = '<span class="badge-modern badge-danger px-3 py-1 text-xs font-500" data-lang-key="incomplete-badge">❌ INCOMPLETE</span>';
                } else {
                    checklistBadge = '<span class="badge-modern px-3 py-1 text-xs font-500" data-lang-key="no-checklist-badge">NO CHECKLIST</span>';
                }

                // Determine profit display
                let profitDisplay = '';
                
                if (record.result === 'Win') {
                    profitDisplay = `<div class="mt-2 text-sm font-700 text-green-400">💰 +${record.profitAmount ? record.profitAmount.toFixed(2) : '0.00'}</div>`;
                } else if (record.result === 'Loss') {
                    profitDisplay = `<div class="mt-2 text-sm font-700 text-red-400">💸 -${record.riskAmount ? record.riskAmount.toFixed(2) : '0.00'}</div>`;
                }

                return `
                    <div class="record-card ${accentClass} p-4 mb-4">
                        <!-- Header - Always visible -->
                        <div class="cursor-pointer" onclick="toggleRecord(${record.id})">
                            <div class="flex justify-between items-center">
                                <div class="flex items-center gap-4">
                                    <div>
                                        <h3 class="text-sm font-700 text-white mb-1">${record.type === 'forex' ? record.currencyPair : record.cryptoCoin}</h3>
                                        <p class="text-xs font-400 text-purple-300">${date} ${time}</p>
                                    </div>
                                    ${statusBadge}
                                </div>
                                <div class="flex items-center gap-3">
                                    ${profitDisplay ? profitDisplay.replace('<div class="mt-2 text-sm font-700', '<span class="text-sm font-700').replace('</div>', '</span>').replace('💰 ', '').replace('💸 ', '') : '<span class="text-sm text-purple-300 font-400" data-lang-key="pending-status">PENDING</span>'}
                                    <svg id="arrow-${record.id}" width="20" height="20" class="transition-all text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                                    </svg>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Expandable Details -->
                        <div id="details-${record.id}" class="hidden border-t border-purple-500/30 mt-4 pt-4">
                            <div class="space-y-4">
                                <div class="grid grid-cols-2 gap-4 text-sm">
                                    <div>
                                        <span class="text-white font-600" data-lang-key="entry">ENTRY:</span>
                                        <span class="glow-text font-700 ml-2">${record.entryPrice}</span>
                                    </div>
                                    <div>
                                        <span class="text-white font-600" data-lang-key="sl">SL:</span>
                                        <span class="glow-text font-700 ml-2">${record.stopLoss}</span>
                                    </div>
                                </div>
                                
                                ${record.tp ? `
                                    <div class="text-sm">
                                        <span class="text-white font-600" data-lang-key="tp">TP:</span>
                                        <span class="glow-text font-700 ml-2">${record.tp}</span>
                                        ${record.rr ? `<span class="ml-2 glow-text font-600">R:R ${record.rr}</span>` : ''}
                                    </div>
                                ` : ''}
                                
                                ${record.result === 'Loss' && record.lossReason ? `
                                    <div class="text-sm modern-card p-3" style="background: rgba(239, 68, 68, 0.1);">
                                        <span class="text-white font-600" data-lang-key="loss-reason">LOSS REASON:</span>
                                        <span class="text-white ml-2 font-400">${record.lossReason}</span>
                                    </div>
                                ` : ''}
                                
                                <div class="flex gap-2">
                                    ${checklistBadge}
                                    ${record.checklistProgress ? `
                                        <span class="text-sm font-600 text-white">${record.checklistProgress}</span>
                                    ` : ''}
                                </div>
                                
                                <div class="flex gap-3 pt-3 border-t border-purple-500/30">
                                    <button onclick="editRecord(${record.id}); event.stopPropagation();" class="pill-button flex-1 py-3 px-4 text-sm font-600" data-lang-key="edit-trade">
                                        ✏️ EDIT
                                    </button>
                                    <button onclick="deleteRecordDirect(${record.id}); event.stopPropagation();" class="danger-glow py-3 px-4 text-sm font-600 rounded-full" data-lang-key="delete">
                                        🗑️
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');

            recordsList.innerHTML = recordsHTML;
            
            // Update language for dynamically added content
            updateLanguage();
        }

        // Toggle record details
        function toggleRecord(id) {
            const details = document.getElementById(`details-${id}`);
            const arrow = document.getElementById(`arrow-${id}`);
            
            if (details.classList.contains('hidden')) {
                details.classList.remove('hidden');
                arrow.style.transform = 'rotate(180deg)';
            } else {
                details.classList.add('hidden');
                arrow.style.transform = 'rotate(0deg)';
            }
        }

        // Delete record directly
        function deleteRecordDirect(id) {
            if (confirm('DELETE THIS RECORD?')) {
                tradingRecords = tradingRecords.filter(r => r.id !== id);
                localStorage.setItem('tradingRecords', JSON.stringify(tradingRecords));
                loadRecords();
                alert('RECORD DELETED!');
            }
        }

        // Edit record
        function editRecord(id) {
            const record = tradingRecords.find(r => r.id === id);
            if (!record) return;

            currentEditingId = id;
            
            // Populate edit form
            document.getElementById('editOrderType').value = record.orderType || '';
            document.getElementById('editTP').value = record.tp || '';
            document.getElementById('editResult').value = record.result || '';
            
            // Set initial field states
            const tpField = document.getElementById('editTP');
            const resultField = document.getElementById('editResult');
            
            if (!record.orderType) {
                tpField.disabled = true;
                tpField.classList.add('opacity-50', 'cursor-not-allowed');
                resultField.disabled = true;
                resultField.classList.add('opacity-50', 'cursor-not-allowed');
            } else {
                tpField.disabled = false;
                tpField.classList.remove('opacity-50', 'cursor-not-allowed');
                
                if (!record.tp) {
                    resultField.disabled = true;
                    resultField.classList.add('opacity-50', 'cursor-not-allowed');
                } else {
                    resultField.disabled = false;
                    resultField.classList.remove('opacity-50', 'cursor-not-allowed');
                }
            }
            
            if (record.result === 'Win') {
                document.getElementById('editProfitSection').classList.remove('hidden');
                document.getElementById('editLossSection').classList.add('hidden');
                document.getElementById('editProfitAmount').value = record.profitAmount || '';
            } else if (record.result === 'Loss') {
                document.getElementById('editProfitSection').classList.add('hidden');
                document.getElementById('editLossSection').classList.remove('hidden');
                document.getElementById('editLossAmount').value = record.riskAmount;
                
                // Load loss reason
                document.getElementById('editLossReason').value = record.lossReason || '';
                const otherText = currentLanguage === 'en' ? 'Other' : 'อื่นๆ';
                
                if ((record.lossReason === 'อื่นๆ' || record.lossReason === 'Other') && record.customLossReason) {
                    document.getElementById('customLossReasonSection').classList.remove('hidden');
                    document.getElementById('editCustomLossReason').value = record.customLossReason;
                } else {
                    document.getElementById('customLossReasonSection').classList.add('hidden');
                    document.getElementById('editCustomLossReason').value = '';
                }
            } else {
                document.getElementById('editProfitSection').classList.add('hidden');
                document.getElementById('editLossSection').classList.add('hidden');
            }

            if (record.rr) {
                document.getElementById('editRRSection').classList.remove('hidden');
                document.getElementById('editRR').value = record.rr;
            } else {
                document.getElementById('editRRSection').classList.add('hidden');
            }

            document.getElementById('editModal').classList.remove('hidden');
            
            // Update language for modal content
            updateLanguage();
        }

        // Edit form handlers
        document.getElementById('editOrderType').addEventListener('change', handleOrderTypeChange);
        document.getElementById('editTP').addEventListener('input', calculateProfitFromTP);
        document.getElementById('editResult').addEventListener('change', handleResultChange);
        document.getElementById('editLossReason').addEventListener('change', handleLossReasonChange);

        function handleOrderTypeChange() {
            const orderType = document.getElementById('editOrderType').value;
            const tpField = document.getElementById('editTP');
            const resultField = document.getElementById('editResult');
            
            if (orderType) {
                tpField.disabled = false;
                tpField.classList.remove('opacity-50', 'cursor-not-allowed');
            } else {
                tpField.disabled = true;
                tpField.value = '';
                tpField.classList.add('opacity-50', 'cursor-not-allowed');
                
                // Also disable and reset result field
                resultField.disabled = true;
                resultField.value = '';
                resultField.classList.add('opacity-50', 'cursor-not-allowed');
                
                // Hide profit/loss sections
                document.getElementById('editProfitSection').classList.add('hidden');
                document.getElementById('editLossSection').classList.add('hidden');
                document.getElementById('editRRSection').classList.add('hidden');
            }
        }

        function calculateProfitFromTP() {
            const record = tradingRecords.find(r => r.id === currentEditingId);
            if (!record) return;

            const tp = parseFloat(document.getElementById('editTP').value);
            const orderType = document.getElementById('editOrderType').value;
            const resultField = document.getElementById('editResult');
            
            if (!tp || !orderType) {
                // Disable result field if TP is empty
                resultField.disabled = true;
                resultField.value = '';
                resultField.classList.add('opacity-50', 'cursor-not-allowed');
                
                // Hide profit/loss sections
                document.getElementById('editProfitSection').classList.add('hidden');
                document.getElementById('editLossSection').classList.add('hidden');
                document.getElementById('editRRSection').classList.add('hidden');
                return;
            }

            // Enable result field when TP is filled
            resultField.disabled = false;
            resultField.classList.remove('opacity-50', 'cursor-not-allowed');

            let profit = 0;
            
            if (record.type === 'crypto') {
                if (orderType === 'Buy') {
                    profit = (tp - record.entryPrice) * (record.margin * record.leverage) / record.entryPrice;
                } else if (orderType === 'Sell') {
                    profit = (record.entryPrice - tp) * (record.margin * record.leverage) / record.entryPrice;
                }
            } else if (record.type === 'forex') {
                const pipSetting = pipSettings[record.currencyPair];
                const pipDifference = Math.abs(tp - record.entryPrice) * pipSetting.multiplier;
                profit = pipDifference * pipSetting.pipValue * record.lotSize;
            }

            document.getElementById('editProfitAmount').value = profit.toFixed(2);
            
            // Calculate R:R
            if (profit > 0) {
                const rr = (profit / record.riskAmount).toFixed(2);
                document.getElementById('editRR').value = `1:${rr}`;
            }
        }

        function handleResultChange() {
            const result = document.getElementById('editResult').value;
            const record = tradingRecords.find(r => r.id === currentEditingId);
            
            if (result === 'Win') {
                document.getElementById('editProfitSection').classList.remove('hidden');
                document.getElementById('editLossSection').classList.add('hidden');
                document.getElementById('editRRSection').classList.remove('hidden');
                calculateProfitFromTP();
            } else if (result === 'Loss') {
                document.getElementById('editProfitSection').classList.add('hidden');
                document.getElementById('editLossSection').classList.remove('hidden');
                document.getElementById('editRRSection').classList.remove('hidden');
                document.getElementById('editLossAmount').value = record.riskAmount;
                document.getElementById('editRR').value = '1:0';
            } else {
                document.getElementById('editProfitSection').classList.add('hidden');
                document.getElementById('editLossSection').classList.add('hidden');
                document.getElementById('editRRSection').classList.add('hidden');
            }
        }

        function handleLossReasonChange() {
            const reason = document.getElementById('editLossReason').value;
            const customSection = document.getElementById('customLossReasonSection');
            
            const otherText = currentLanguage === 'en' ? 'Other' : 'อื่นๆ';
            
            if (reason === otherText) {
                customSection.classList.remove('hidden');
            } else {
                customSection.classList.add('hidden');
                document.getElementById('editCustomLossReason').value = '';
            }
        }

        // Save edit
        document.getElementById('saveEdit').addEventListener('click', () => {
            const orderType = document.getElementById('editOrderType').value;
            const tp = document.getElementById('editTP').value;
            const result = document.getElementById('editResult').value;

            // Validation
            let hasError = false;
            document.querySelectorAll('#editModal input, #editModal select').forEach(input => {
                input.classList.remove('border-red-500');
            });

            if (!orderType) {
                document.getElementById('editOrderType').classList.add('border-red-500');
                hasError = true;
            }
            if (!tp) {
                document.getElementById('editTP').classList.add('border-red-500');
                hasError = true;
            }
            if (!result) {
                document.getElementById('editResult').classList.add('border-red-500');
                hasError = true;
            }

            if (hasError) {
                alert('FILL ALL REQUIRED FIELDS');
                return;
            }

            // Get loss reason data
            let lossReason = null;
            let customLossReason = null;
            
            if (result === 'Loss') {
                lossReason = document.getElementById('editLossReason').value;
                const otherText = currentLanguage === 'en' ? 'Other' : 'อื่นๆ';
                
                if (lossReason === otherText) {
                    customLossReason = document.getElementById('editCustomLossReason').value.trim();
                    if (!customLossReason) {
                        alert('SPECIFY CUSTOM REASON');
                        return;
                    }
                    lossReason = customLossReason;
                }
                
                if (!lossReason) {
                    document.getElementById('editLossReason').classList.add('border-red-500');
                    alert('SELECT LOSS REASON');
                    return;
                }
            }

            // Update record
            const recordIndex = tradingRecords.findIndex(r => r.id === currentEditingId);
            if (recordIndex !== -1) {
                tradingRecords[recordIndex] = {
                    ...tradingRecords[recordIndex],
                    orderType,
                    tp: parseFloat(tp),
                    result,
                    profitAmount: result === 'Win' ? parseFloat(document.getElementById('editProfitAmount').value) : null,
                    rr: document.getElementById('editRR').value,
                    lossReason: result === 'Loss' ? lossReason : null,
                    customLossReason: result === 'Loss' && (document.getElementById('editLossReason').value === 'อื่นๆ' || document.getElementById('editLossReason').value === 'Other') ? customLossReason : null
                };

                localStorage.setItem('tradingRecords', JSON.stringify(tradingRecords));
                document.getElementById('editModal').classList.add('hidden');
                loadRecords();
                alert('RECORD UPDATED!');
            }
        });

        // Cancel edit
        document.getElementById('cancelEdit').addEventListener('click', () => {
            document.getElementById('editModal').classList.add('hidden');
        });

        // Delete record
        document.getElementById('deleteRecord').addEventListener('click', () => {
            if (confirm('DELETE THIS RECORD?')) {
                tradingRecords = tradingRecords.filter(r => r.id !== currentEditingId);
                localStorage.setItem('tradingRecords', JSON.stringify(tradingRecords));
                document.getElementById('editModal').classList.add('hidden');
                loadRecords();
                alert('RECORD DELETED!');
            }
        });

        // Load statistics
        function loadStats() {
            const totalTrades = tradingRecords.filter(r => r.result).length;
            const wins = tradingRecords.filter(r => r.result === 'Win').length;
            const losses = tradingRecords.filter(r => r.result === 'Loss').length;
            const winRate = totalTrades > 0 ? ((wins / totalTrades) * 100).toFixed(1) : 0;
            
            const totalProfit = tradingRecords
                .filter(r => r.result === 'Win')
                .reduce((sum, r) => sum + (r.profitAmount || 0), 0);
            
            const totalLoss = tradingRecords
                .filter(r => r.result === 'Loss')
                .reduce((sum, r) => sum + (r.riskAmount || 0), 0);
            
            const netProfit = totalProfit - totalLoss;

            // Calculate average R:R
            const rrValues = tradingRecords
                .filter(r => r.rr && r.rr !== '1:0')
                .map(r => parseFloat(r.rr.split(':')[1]));
            
            const avgRR = rrValues.length > 0 ? 
                `1:${(rrValues.reduce((sum, val) => sum + val, 0) / rrValues.length).toFixed(2)}` : 
                '0:0';

            document.getElementById('totalTrades').textContent = totalTrades;
            document.getElementById('winRate').textContent = `${winRate}%`;
            
            // Display net profit with appropriate color and sign
            const netProfitElement = document.getElementById('netProfit');
            if (netProfit >= 0) {
                netProfitElement.textContent = `+${netProfit.toFixed(2)}`;
                netProfitElement.className = 'text-2xl font-800 text-green-400';
            } else {
                netProfitElement.textContent = `${netProfit.toFixed(2)}`;
                netProfitElement.className = 'text-2xl font-800 text-red-400';
            }
            
            document.getElementById('avgRR').textContent = avgRR;
            
            // Calculate win/loss streaks
            const streaks = calculateStreaks();
            document.getElementById('winStreak').textContent = streaks.maxWinStreak;
            document.getElementById('lossStreak').textContent = streaks.maxLossStreak;

            // Modern chart
            if (totalTrades > 0) {
                const chartHTML = `
                    <div class="flex items-end justify-center space-x-6 h-24">
                        <div class="flex flex-col items-center">
                            <div class="success-glow rounded-lg" style="height: ${(wins/totalTrades)*80}px; width: 50px;"></div>
                            <span class="text-xs mt-2 font-600 text-white">WIN (${wins})</span>
                        </div>
                        <div class="flex flex-col items-center">
                            <div class="danger-glow rounded-lg" style="height: ${(losses/totalTrades)*80}px; width: 50px;"></div>
                            <span class="text-xs mt-2 font-600 text-white">LOSS (${losses})</span>
                        </div>
                    </div>
                `;
                document.getElementById('chartContainer').innerHTML = chartHTML;
            }

            // Load preset statistics
            loadPresetStats();
        }

        // Calculate cumulative win/loss counts
        function calculateStreaks() {
            // Get records with results
            const recordsWithResults = tradingRecords.filter(r => r.result);
            
            if (recordsWithResults.length === 0) {
                return { maxWinStreak: 0, maxLossStreak: 0 };
            }
            
            // Simply count total wins and losses
            const totalWins = recordsWithResults.filter(r => r.result === 'Win').length;
            const totalLosses = recordsWithResults.filter(r => r.result === 'Loss').length;
            
            return { maxWinStreak: totalWins, maxLossStreak: totalLosses };
        }

        // Load preset statistics
        function loadPresetStats() {
            const presetStatsContainer = document.getElementById('presetStats');
            
            // Get records with preset data and results
            const recordsWithPresets = tradingRecords.filter(r => 
                r.presetId && r.result
            );
            
            if (recordsWithPresets.length === 0) {
                presetStatsContainer.innerHTML = '<p class="text-sm text-center py-6 text-purple-300 font-400">NO PRESET DATA</p>';
                return;
            }

            // Group by preset ID
            const presetGroups = {};
            recordsWithPresets.forEach(record => {
                if (!presetGroups[record.presetId]) {
                    presetGroups[record.presetId] = [];
                }
                presetGroups[record.presetId].push(record);
            });

            let statsHTML = '';
            const presetStats = [];

            // Calculate stats for each preset
            Object.keys(presetGroups).forEach(presetId => {
                const preset = checklistPresets.find(p => p.id == presetId);
                if (!preset) return;

                const records = presetGroups[presetId];
                const wins = records.filter(r => r.result === 'Win').length;
                const losses = records.filter(r => r.result === 'Loss').length;
                const total = records.length;
                const winRate = total > 0 ? ((wins / total) * 100).toFixed(1) : 0;

                presetStats.push({
                    preset,
                    wins,
                    losses,
                    total,
                    winRate: parseFloat(winRate)
                });

                // Color scheme based on win rate
                let bgColor = 'rgba(139, 92, 246, 0.1)';
                
                if (winRate >= 70) {
                    bgColor = 'rgba(16, 185, 129, 0.1)';
                } else if (winRate >= 50) {
                    bgColor = 'rgba(139, 92, 246, 0.1)';
                } else {
                    bgColor = 'rgba(239, 68, 68, 0.1)';
                }

                statsHTML += `
                    <div class="modern-card p-5 mb-4" style="background: ${bgColor};">
                        <div class="flex items-center gap-3 mb-4">
                            <span class="text-sm">📋</span>
                            <h4 class="font-700 text-sm text-white">${preset.name}</h4>
                        </div>
                        
                        <div class="grid grid-cols-3 gap-4 mb-4">
                            <div class="text-center">
                                <div class="text-sm font-700 glow-text">${total}</div>
                                <div class="text-xs font-400 text-white">TOTAL</div>
                            </div>
                            <div class="text-center">
                                <div class="text-sm font-700 text-green-400">${wins}</div>
                                <div class="text-xs font-400 text-white">WIN</div>
                            </div>
                            <div class="text-center">
                                <div class="text-sm font-700 text-red-400">${losses}</div>
                                <div class="text-xs font-400 text-white">LOSS</div>
                            </div>
                        </div>
                        
                        <div class="stat-card p-4 text-center">
                            <div class="text-sm font-700 glow-text">${winRate}%</div>
                            <div class="text-xs font-400 text-white">WIN RATE</div>
                        </div>
                    </div>
                `;
            });

            // Add comparison if multiple presets exist
            if (presetStats.length > 1) {
                // Sort by win rate
                presetStats.sort((a, b) => b.winRate - a.winRate);
                const best = presetStats[0];
                const worst = presetStats[presetStats.length - 1];
                
                if (best.winRate !== worst.winRate) {
                    const difference = (best.winRate - worst.winRate).toFixed(1);
                    
                    statsHTML += `
                        <div class="modern-card p-5" style="background: rgba(139, 92, 246, 0.15);">
                            <div class="text-center">
                                <h4 class="font-700 text-sm mb-3 text-white">🏆 PRESET COMPARISON</h4>
                                <p class="text-sm mb-3 text-white font-400">
                                    <span class="font-700 text-green-400">${best.preset.name}</span>
                                    HAS HIGHEST WIN RATE
                                    <span class="font-700 text-green-400">${best.winRate}%</span>
                                </p>
                                <p class="text-sm text-white font-400">
                                    BETTER THAN
                                    <span class="font-700 text-red-400">${worst.preset.name}</span>
                                    BY <span class="font-700 glow-text">${difference}%</span>
                                </p>
                                <p class="text-sm mt-3 blink-glow text-white font-600">
                                    💡 USE "${best.preset.name}" MORE!
                                </p>
                            </div>
                        </div>
                    `;
                }
            }

            presetStatsContainer.innerHTML = statsHTML;
        }

        // Initialize
        checkDailyLimit();
        
        // Load saved active preset
        const savedActivePresetId = localStorage.getItem('activePresetId');
        if (savedActivePresetId) {
            activePresetId = parseInt(savedActivePresetId);
        }
        
        // Techniques functionality
        function loadTechniques() {
            const categoriesList = document.getElementById('categoriesList');
            
            if (techniqueCategories.length === 0) {
                categoriesList.innerHTML = '<p class="text-center py-8 text-purple-300 text-sm font-400" data-lang-key="no-categories">NO CATEGORIES YET</p>';
                updateLanguage();
                return;
            }

            const categoriesHTML = techniqueCategories.map(category => {
                const imageCount = category.images ? category.images.length : 0;
                return `
                    <div class="modern-card p-4 category-card" data-category-id="${category.id}">
                        <!-- Category Header - Clickable -->
                        <div class="cursor-pointer" onclick="toggleCategory(${category.id})">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center gap-3">
                                    <span class="text-xl">${category.icon}</span>
                                    <div>
                                        <h3 class="text-base font-700 text-white">${category.name}</h3>
                                        <p class="text-xs text-purple-300">${imageCount} IMAGES</p>
                                    </div>
                                </div>
                                <svg id="category-arrow-${category.id}" width="16" height="16" class="transition-all text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                                </svg>
                            </div>
                        </div>
                        
                        <!-- Category Controls -->
                        <div class="flex gap-2 mt-3 mb-4">
                            <button onclick="addImageToCategory(${category.id}); event.stopPropagation();" class="pill-button px-3 py-2 text-xs font-600 flex-1" data-lang-key="add-image">
                                ➕ ADD IMAGE
                            </button>
                            <button onclick="editCategory(${category.id}); event.stopPropagation();" class="language-toggle px-3 py-2 text-xs font-600" data-lang-key="edit-category">
                                ✏️
                            </button>
                            <button onclick="deleteCategory(${category.id}); event.stopPropagation();" class="danger-glow px-3 py-2 text-xs font-600 rounded-full" data-lang-key="delete-category">
                                🗑️
                            </button>
                        </div>
                        
                        <!-- Collapsible Images Grid -->
                        <div class="images-grid grid grid-cols-2 gap-3 hidden" id="images-${category.id}">
                            ${category.images && category.images.length > 0 ? 
                                category.images.map(image => `
                                    <div class="image-card modern-card p-3 relative group cursor-pointer" onclick="openFullScreen(${category.id}, ${image.id})">
                                        <img src="${image.url || image.dataUrl}" alt="${image.title}" class="w-full h-24 object-cover rounded-lg mb-2 hover:scale-105 transition-transform" 
                                             onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjEyOCIgdmlld0JveD0iMCAwIDIwMCAxMjgiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIyMDAiIGhlaWdodD0iMTI4IiBmaWxsPSIjMUExQTJFIi8+Cjx0ZXh0IHg9IjEwMCIgeT0iNjQiIGZpbGw9IiM4QjVDRjYiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSIxMiIgZHk9Ii4zZW0iPklNQUdFIEVSUk9SPC90ZXh0Pgo8L3N2Zz4K';">
                                        
                                        <!-- Fullscreen indicator -->
                                        <div class="absolute inset-0 bg-black bg-opacity-0 hover:bg-opacity-30 transition-all rounded-lg flex items-center justify-center">
                                            <div class="text-white text-xl opacity-0 group-hover:opacity-100 transition-opacity">🔍</div>
                                        </div>
                                        
                                        <h4 class="text-xs font-600 text-white mb-1">${image.title}</h4>
                                        ${image.description ? `<p class="text-xs text-purple-300 mb-2 line-clamp-2">${image.description}</p>` : ''}
                                        <div class="absolute top-1 right-1 opacity-0 group-hover:opacity-100 transition-opacity flex gap-1">
                                            <button onclick="editImage(${category.id}, ${image.id}); event.stopPropagation();" class="language-toggle px-1 py-1 text-xs rounded" data-lang-key="edit-image">
                                                ✏️
                                            </button>
                                            <button onclick="deleteImage(${category.id}, ${image.id}); event.stopPropagation();" class="danger-glow px-1 py-1 text-xs rounded" data-lang-key="delete-image">
                                                🗑️
                                            </button>
                                        </div>
                                    </div>
                                `).join('') : 
                                '<p class="text-center py-6 text-purple-300 text-xs font-400 col-span-2" data-lang-key="no-images">NO IMAGES IN THIS CATEGORY</p>'
                            }
                        </div>
                    </div>
                `;
            }).join('');

            categoriesList.innerHTML = categoriesHTML;
            updateLanguage();
        }

        // Toggle category visibility
        function toggleCategory(categoryId) {
            const imagesGrid = document.getElementById(`images-${categoryId}`);
            const arrow = document.getElementById(`category-arrow-${categoryId}`);
            
            if (imagesGrid.classList.contains('hidden')) {
                imagesGrid.classList.remove('hidden');
                arrow.style.transform = 'rotate(180deg)';
            } else {
                imagesGrid.classList.add('hidden');
                arrow.style.transform = 'rotate(0deg)';
            }
        }

        // Category management
        document.getElementById('addCategoryBtn').addEventListener('click', () => {
            openCategoryModal();
        });

        function openCategoryModal(category = null) {
            const modal = document.getElementById('categoryModal');
            const title = document.getElementById('categoryModalTitle');
            const nameInput = document.getElementById('categoryName');
            
            if (category) {
                title.setAttribute('data-lang-key', 'edit-category-title');
                title.textContent = currentLanguage === 'en' ? '✏️ EDIT CATEGORY' : '✏️ แก้ไขหมวดหมู่';
                nameInput.value = category.name;
                document.getElementById('selectedIcon').value = category.icon;
                
                // Highlight selected icon
                document.querySelectorAll('.icon-option').forEach(btn => {
                    btn.classList.remove('pill-button');
                    btn.classList.add('modern-input');
                });
                document.querySelector(`[data-icon="${category.icon}"]`).classList.remove('modern-input');
                document.querySelector(`[data-icon="${category.icon}"]`).classList.add('pill-button');
                
                currentEditingCategoryId = category.id;
            } else {
                title.setAttribute('data-lang-key', 'add-category-title');
                title.textContent = currentLanguage === 'en' ? '📚 ADD NEW CATEGORY' : '📚 เพิ่มหมวดหมู่ใหม่';
                nameInput.value = '';
                document.getElementById('selectedIcon').value = '🕯️';
                
                // Reset icon selection
                document.querySelectorAll('.icon-option').forEach(btn => {
                    btn.classList.remove('pill-button');
                    btn.classList.add('modern-input');
                });
                document.querySelector('[data-icon="🕯️"]').classList.remove('modern-input');
                document.querySelector('[data-icon="🕯️"]').classList.add('pill-button');
                
                currentEditingCategoryId = null;
            }
            
            modal.classList.remove('hidden');
            updateLanguage();
        }

        // Icon selection
        document.querySelectorAll('.icon-option').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.icon-option').forEach(b => {
                    b.classList.remove('pill-button');
                    b.classList.add('modern-input');
                });
                btn.classList.remove('modern-input');
                btn.classList.add('pill-button');
                document.getElementById('selectedIcon').value = btn.getAttribute('data-icon');
            });
        });

        // Save category
        document.getElementById('saveCategory').addEventListener('click', () => {
            const name = document.getElementById('categoryName').value.trim();
            const icon = document.getElementById('selectedIcon').value;
            
            if (!name) {
                alert(currentLanguage === 'en' ? 'ENTER CATEGORY NAME' : 'กรอกชื่อหมวดหมู่');
                return;
            }
            
            if (currentEditingCategoryId) {
                // Edit existing category
                const categoryIndex = techniqueCategories.findIndex(c => c.id === currentEditingCategoryId);
                if (categoryIndex !== -1) {
                    techniqueCategories[categoryIndex] = {
                        ...techniqueCategories[categoryIndex],
                        name,
                        icon
                    };
                }
            } else {
                // Create new category
                const newCategory = {
                    id: Date.now(),
                    name,
                    icon,
                    images: []
                };
                techniqueCategories.push(newCategory);
            }
            
            localStorage.setItem('techniqueCategories', JSON.stringify(techniqueCategories));
            document.getElementById('categoryModal').classList.add('hidden');
            loadTechniques();
            
            alert(currentLanguage === 'en' ? 'CATEGORY SAVED!' : 'บันทึกหมวดหมู่แล้ว!');
        });

        // Cancel category
        document.getElementById('cancelCategory').addEventListener('click', () => {
            document.getElementById('categoryModal').classList.add('hidden');
            currentEditingCategoryId = null;
        });

        // Edit category
        function editCategory(categoryId) {
            const category = techniqueCategories.find(c => c.id === categoryId);
            if (category) {
                openCategoryModal(category);
            }
        }

        // Delete category
        function deleteCategory(categoryId) {
            const confirmText = currentLanguage === 'en' ? 'DELETE THIS CATEGORY AND ALL IMAGES?' : 'ลบหมวดหมู่นี้และรูปภาพทั้งหมด?';
            if (confirm(confirmText)) {
                techniqueCategories = techniqueCategories.filter(c => c.id !== categoryId);
                localStorage.setItem('techniqueCategories', JSON.stringify(techniqueCategories));
                loadTechniques();
                
                const successText = currentLanguage === 'en' ? 'CATEGORY DELETED!' : 'ลบหมวดหมู่แล้ว!';
                alert(successText);
            }
        }

        // Image management
        function addImageToCategory(categoryId) {
            currentCategoryId = categoryId;
            openImageModal();
        }

        function openImageModal(image = null) {
            const modal = document.getElementById('imageModal');
            const title = document.getElementById('imageModalTitle');
            const titleInput = document.getElementById('imageTitle');
            const urlInput = document.getElementById('imageUrl');
            const fileInput = document.getElementById('imageFile');
            const descInput = document.getElementById('imageDescription');
            
            if (image) {
                title.setAttribute('data-lang-key', 'edit-image-title');
                title.textContent = currentLanguage === 'en' ? '✏️ EDIT IMAGE' : '✏️ แก้ไขรูปภาพ';
                titleInput.value = image.title;
                urlInput.value = image.url || '';
                descInput.value = image.description || '';
                currentEditingImageId = image.id;
                
                // Set source type based on existing image
                if (image.dataUrl) {
                    switchImageSource('file');
                } else {
                    switchImageSource('url');
                }
            } else {
                title.setAttribute('data-lang-key', 'add-image-title');
                title.textContent = currentLanguage === 'en' ? '🖼️ ADD NEW IMAGE' : '🖼️ เพิ่มรูปภาพใหม่';
                titleInput.value = '';
                urlInput.value = '';
                fileInput.value = '';
                descInput.value = '';
                currentEditingImageId = null;
                
                // Default to URL source
                switchImageSource('url');
            }
            
            modal.classList.remove('hidden');
            updateLanguage();
        }

        // Image source switching
        function switchImageSource(sourceType) {
            const urlBtn = document.getElementById('urlSourceBtn');
            const fileBtn = document.getElementById('fileSourceBtn');
            const urlSection = document.getElementById('urlSourceSection');
            const fileSection = document.getElementById('fileSourceSection');
            
            if (sourceType === 'url') {
                urlBtn.className = 'pill-button flex-1 py-2 text-xs font-600';
                fileBtn.className = 'language-toggle flex-1 py-2 text-xs font-600 rounded-full';
                urlSection.classList.remove('hidden');
                fileSection.classList.add('hidden');
            } else {
                fileBtn.className = 'pill-button flex-1 py-2 text-xs font-600';
                urlBtn.className = 'language-toggle flex-1 py-2 text-xs font-600 rounded-full';
                fileSection.classList.remove('hidden');
                urlSection.classList.add('hidden');
            }
        }

        // Add event listeners for source switching
        document.getElementById('urlSourceBtn').addEventListener('click', () => switchImageSource('url'));
        document.getElementById('fileSourceBtn').addEventListener('click', () => switchImageSource('file'));

        // Save image
        document.getElementById('saveImage').addEventListener('click', () => {
            const title = document.getElementById('imageTitle').value.trim();
            const url = document.getElementById('imageUrl').value.trim();
            const fileInput = document.getElementById('imageFile');
            const description = document.getElementById('imageDescription').value.trim();
            
            if (!title) {
                alert(currentLanguage === 'en' ? 'ENTER IMAGE TITLE' : 'กรอกชื่อรูปภาพ');
                return;
            }
            
            // Check if URL source is active and has URL
            const urlSection = document.getElementById('urlSourceSection');
            const isUrlSource = !urlSection.classList.contains('hidden');
            
            // Check if file source is active and has file
            const fileSection = document.getElementById('fileSourceSection');
            const isFileSource = !fileSection.classList.contains('hidden');
            
            // Validation for new images
            if (!currentEditingImageId) {
                if (isUrlSource && !url) {
                    alert(currentLanguage === 'en' ? 'ENTER IMAGE URL' : 'กรอก URL รูปภาพ');
                    return;
                }
                
                if (isFileSource && !fileInput.files[0]) {
                    alert(currentLanguage === 'en' ? 'SELECT IMAGE FILE' : 'เลือกไฟล์รูปภาพ');
                    return;
                }
            }
            
            const categoryIndex = techniqueCategories.findIndex(c => c.id === currentCategoryId);
            if (categoryIndex === -1) {
                alert(currentLanguage === 'en' ? 'CATEGORY NOT FOUND' : 'ไม่พบหมวดหมู่');
                return;
            }
            
            // Handle file upload
            if (isFileSource && fileInput.files[0]) {
                const file = fileInput.files[0];
                
                // Validate file type
                if (!file.type.startsWith('image/')) {
                    alert(currentLanguage === 'en' ? 'PLEASE SELECT IMAGE FILE' : 'กรุณาเลือกไฟล์รูปภาพ');
                    return;
                }
                
                // Validate file size (max 5MB)
                if (file.size > 5 * 1024 * 1024) {
                    alert(currentLanguage === 'en' ? 'IMAGE TOO LARGE (MAX 5MB)' : 'รูปภาพใหญ่เกินไป (สูงสุด 5MB)');
                    return;
                }
                
                const reader = new FileReader();
                
                reader.onload = function(e) {
                    const imageData = {
                        id: currentEditingImageId || Date.now(),
                        title,
                        dataUrl: e.target.result,
                        description
                    };
                    
                    saveImageData(imageData, categoryIndex);
                };
                
                reader.onerror = function() {
                    alert(currentLanguage === 'en' ? 'ERROR READING FILE' : 'เกิดข้อผิดพลาดในการอ่านไฟล์');
                };
                
                reader.readAsDataURL(file);
            } else {
                // Handle URL or existing image edit
                const imageData = {
                    id: currentEditingImageId || Date.now(),
                    title,
                    description
                };
                
                // Add URL if using URL source
                if (isUrlSource) {
                    imageData.url = url;
                }
                
                // Keep existing dataUrl if editing file-based image without new file
                if (currentEditingImageId && isFileSource) {
                    const existingImage = techniqueCategories[categoryIndex].images.find(img => img.id === currentEditingImageId);
                    if (existingImage && existingImage.dataUrl) {
                        imageData.dataUrl = existingImage.dataUrl;
                    }
                }
                
                saveImageData(imageData, categoryIndex);
            }
        });
        
        function saveImageData(imageData, categoryIndex) {
            try {
                if (currentEditingImageId) {
                    // Edit existing image
                    const imageIndex = techniqueCategories[categoryIndex].images.findIndex(img => img.id === currentEditingImageId);
                    if (imageIndex !== -1) {
                        techniqueCategories[categoryIndex].images[imageIndex] = {
                            ...techniqueCategories[categoryIndex].images[imageIndex],
                            ...imageData
                        };
                    }
                } else {
                    // Add new image
                    if (!techniqueCategories[categoryIndex].images) {
                        techniqueCategories[categoryIndex].images = [];
                    }
                    techniqueCategories[categoryIndex].images.push(imageData);
                }
                
                // Save to localStorage with error handling
                try {
                    localStorage.setItem('techniqueCategories', JSON.stringify(techniqueCategories));
                } catch (e) {
                    if (e.name === 'QuotaExceededError') {
                        alert(currentLanguage === 'en' ? 'STORAGE FULL! DELETE SOME IMAGES' : 'พื้นที่เก็บข้อมูลเต็ม! ลบรูปภาพบางส่วน');
                        return;
                    }
                    throw e;
                }
                
                // Reset form and close modal
                document.getElementById('imageTitle').value = '';
                document.getElementById('imageUrl').value = '';
                document.getElementById('imageFile').value = '';
                document.getElementById('imageDescription').value = '';
                document.getElementById('imageModal').classList.add('hidden');
                
                // Reset editing states
                currentEditingImageId = null;
                currentCategoryId = null;
                
                // Reload techniques display
                loadTechniques();
                
                alert(currentLanguage === 'en' ? 'IMAGE SAVED!' : 'บันทึกรูปภาพแล้ว!');
                
            } catch (error) {
                console.error('Error saving image:', error);
                alert(currentLanguage === 'en' ? 'ERROR SAVING IMAGE' : 'เกิดข้อผิดพลาดในการบันทึกรูปภาพ');
            }
        }

        // Cancel image
        document.getElementById('cancelImage').addEventListener('click', () => {
            // Reset form
            document.getElementById('imageTitle').value = '';
            document.getElementById('imageUrl').value = '';
            document.getElementById('imageFile').value = '';
            document.getElementById('imageDescription').value = '';
            
            // Close modal
            document.getElementById('imageModal').classList.add('hidden');
            
            // Reset editing states
            currentEditingImageId = null;
            currentCategoryId = null;
        });

        // Edit image
        function editImage(categoryId, imageId) {
            const category = techniqueCategories.find(c => c.id === categoryId);
            if (!category) return;
            
            const image = category.images.find(img => img.id === imageId);
            if (!image) return;
            
            currentCategoryId = categoryId;
            openImageModal(image);
        }

        // Delete image
        function deleteImage(categoryId, imageId) {
            const confirmText = currentLanguage === 'en' ? 'DELETE THIS IMAGE?' : 'ลบรูปภาพนี้?';
            if (confirm(confirmText)) {
                const categoryIndex = techniqueCategories.findIndex(c => c.id === categoryId);
                if (categoryIndex !== -1) {
                    techniqueCategories[categoryIndex].images = techniqueCategories[categoryIndex].images.filter(img => img.id !== imageId);
                    localStorage.setItem('techniqueCategories', JSON.stringify(techniqueCategories));
                    loadTechniques();
                    
                    const successText = currentLanguage === 'en' ? 'IMAGE DELETED!' : 'ลบรูปภาพแล้ว!';
                    alert(successText);
                }
            }
        }

        // Full screen image functionality
        let currentFullScreenCategory = null;
        let currentFullScreenImageIndex = 0;

        function openFullScreen(categoryId, imageId) {
            const category = techniqueCategories.find(c => c.id === categoryId);
            if (!category || !category.images) return;
            
            const imageIndex = category.images.findIndex(img => img.id === imageId);
            if (imageIndex === -1) return;
            
            currentFullScreenCategory = category;
            currentFullScreenImageIndex = imageIndex;
            
            showFullScreenImage();
            document.getElementById('fullScreenModal').classList.remove('hidden');
            
            // Show navigation arrows if there are multiple images
            const prevBtn = document.getElementById('prevImage');
            const nextBtn = document.getElementById('nextImage');
            
            if (category.images.length > 1) {
                prevBtn.classList.remove('hidden');
                nextBtn.classList.remove('hidden');
            } else {
                prevBtn.classList.add('hidden');
                nextBtn.classList.add('hidden');
            }
            
            // Prevent body scroll
            document.body.style.overflow = 'hidden';
        }

        function showFullScreenImage() {
            if (!currentFullScreenCategory) return;
            
            const image = currentFullScreenCategory.images[currentFullScreenImageIndex];
            if (!image) return;
            
            document.getElementById('fullScreenImage').src = image.url || image.dataUrl;
            document.getElementById('fullScreenTitle').textContent = image.title;
            document.getElementById('fullScreenDescription').textContent = image.description || '';
            
            // Hide description if empty
            const descElement = document.getElementById('fullScreenDescription');
            if (!image.description) {
                descElement.parentElement.classList.add('hidden');
            } else {
                descElement.parentElement.classList.remove('hidden');
            }
        }

        function closeFullScreen() {
            document.getElementById('fullScreenModal').classList.add('hidden');
            currentFullScreenCategory = null;
            currentFullScreenImageIndex = 0;
            
            // Restore body scroll
            document.body.style.overflow = '';
        }

        function navigateFullScreen(direction) {
            if (!currentFullScreenCategory) return;
            
            const totalImages = currentFullScreenCategory.images.length;
            
            if (direction === 'prev') {
                currentFullScreenImageIndex = (currentFullScreenImageIndex - 1 + totalImages) % totalImages;
            } else if (direction === 'next') {
                currentFullScreenImageIndex = (currentFullScreenImageIndex + 1) % totalImages;
            }
            
            showFullScreenImage();
        }

        // Full screen event listeners
        document.getElementById('closeFullScreen').addEventListener('click', closeFullScreen);
        document.getElementById('prevImage').addEventListener('click', () => navigateFullScreen('prev'));
        document.getElementById('nextImage').addEventListener('click', () => navigateFullScreen('next'));

        // Close full screen when clicking outside image
        document.getElementById('fullScreenModal').addEventListener('click', (e) => {
            if (e.target.id === 'fullScreenModal') {
                closeFullScreen();
            }
        });

        // Keyboard navigation for full screen
        document.addEventListener('keydown', (e) => {
            if (!document.getElementById('fullScreenModal').classList.contains('hidden')) {
                switch(e.key) {
                    case 'Escape':
                        closeFullScreen();
                        break;
                    case 'ArrowLeft':
                        navigateFullScreen('prev');
                        break;
                    case 'ArrowRight':
                        navigateFullScreen('next');
                        break;
                }
            }
        });

        // Initialize language
        updateLanguage();
        
        // Start with checklist page
        switchPage('checklist');
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'962b46db6346c8e3',t:'MTc1MzEwNjk3NC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
