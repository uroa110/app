<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HOPEYA TRADING - Checklist & Calculator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600;700&display=swap');
        body { font-family: 'Kanit', sans-serif; }
        .gradient-bg { background: linear-gradient(135deg, #3b82f6 0%, #1e40af 100%); }
        .card-shadow { box-shadow: 0 10px 25px rgba(59, 130, 246, 0.1); }
        .input-focus:focus { border-color: #3b82f6; box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1); }
        .preset-card { transition: all 0.3s ease; }
        .preset-card:hover { transform: translateY(-2px); }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- Header -->
    <div class="gradient-bg text-white py-6 px-4">
        <div class="max-w-md mx-auto text-center">
            <h1 class="text-2xl font-bold mb-2">üìà HOPEYA TRADING</h1>
            <p class="text-blue-100">‡πÄ‡∏ä‡πá‡∏Ñ‡∏•‡∏¥‡∏™‡∏ï‡πå & ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Å‡∏≤‡∏£‡πÄ‡∏ó‡∏£‡∏î</p>
        </div>
    </div>

    <!-- Navigation -->
    <div class="max-w-md mx-auto px-4 py-4">
        <div class="bg-white rounded-xl card-shadow p-4 mb-4">
            <div class="grid grid-cols-4 gap-2">
                <button id="checklistTab" class="nav-btn bg-blue-500 text-white py-2 px-2 rounded-lg text-xs font-medium transition-all">
                    ‚úÖ ‡πÄ‡∏ä‡πá‡∏Ñ‡∏•‡∏¥‡∏™‡∏ï‡πå
                </button>
                <button id="calculatorTab" class="nav-btn bg-gray-200 text-gray-700 py-2 px-2 rounded-lg text-xs font-medium transition-all">
                    üßÆ ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì
                </button>
                <button id="recordsTab" class="nav-btn bg-gray-200 text-gray-700 py-2 px-2 rounded-lg text-xs font-medium transition-all">
                    üìù ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ú‡∏•
                </button>
                <button id="statsTab" class="nav-btn bg-gray-200 text-gray-700 py-2 px-2 rounded-lg text-xs font-medium transition-all">
                    üìä ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥
                </button>
            </div>
        </div>
    </div>

    <!-- Daily Limit Warning -->
    <div id="dailyLimitWarning" class="max-w-md mx-auto px-4 mb-4 hidden">
        <div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded-xl">
            <div class="text-center">
                <p class="font-bold">üö´ ‡πÄ‡∏ó‡∏£‡∏î‡∏Ñ‡∏£‡∏ö‡πÅ‡∏•‡πâ‡∏ß 5 ‡πÑ‡∏°‡πâ</p>
                <p class="text-sm">‡∏ß‡∏¥‡∏ô‡∏±‡∏¢‡∏™‡∏±‡∏™‡∏ß‡∏¥‡∏ô‡∏±‡∏¢‡∏≠‡∏¢‡∏≤‡∏Å‡∏°‡∏µ‡∏≠‡∏¥‡∏™‡∏£‡∏∞‡∏†‡∏≤‡∏û‡∏£‡∏∂‡πÄ‡∏õ‡∏•‡πà‡∏≤!!!</p>
                <p class="text-xs mt-2">‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÄ‡∏ß‡∏•‡∏≤ 06:00 ‡∏ô. ‡∏ß‡∏±‡∏ô‡∏ñ‡∏±‡∏î‡πÑ‡∏õ</p>
            </div>
        </div>
    </div>

    <!-- Main Container -->
    <div class="max-w-md mx-auto px-4 py-2">
        <!-- Checklist Page -->
        <div id="checklistPage">
            <!-- Preset Management -->
            <div class="bg-white rounded-xl card-shadow p-6 mb-6">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-lg font-semibold text-gray-800">üìã ‡∏û‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡πÄ‡∏ä‡πá‡∏Ñ‡∏•‡∏¥‡∏™‡∏ï‡πå</h2>
                    <button id="createPresetBtn" class="bg-green-500 text-white px-4 py-2 rounded-lg text-sm font-medium hover:bg-green-600 transition-colors">
                        ‚ûï ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÉ‡∏´‡∏°‡πà
                    </button>
                </div>
                
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏û‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï</label>
                        <select id="presetSelector" class="w-full p-3 border border-gray-300 rounded-lg input-focus">
                            <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏û‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï --</option>
                        </select>
                    </div>
                    
                    <div id="presetActions" class="flex gap-2 hidden">
                        <button id="editSelectedPreset" class="flex-1 bg-blue-500 text-white px-4 py-2 rounded-lg text-sm font-medium hover:bg-blue-600 transition-colors">
                            ‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
                        </button>
                        <button id="deleteSelectedPreset" class="flex-1 bg-red-500 text-white px-4 py-2 rounded-lg text-sm font-medium hover:bg-red-600 transition-colors">
                            üóëÔ∏è ‡∏•‡∏ö
                        </button>
                    </div>
                </div>
            </div>

            <!-- Active Checklist -->
            <div id="activeChecklistSection" class="bg-white rounded-xl card-shadow p-6 mb-6 hidden">
                <div class="flex justify-between items-center mb-4">
                    <h3 id="activePresetName" class="text-lg font-semibold text-gray-800"></h3>
                    <div class="flex gap-2">
                        <button id="editActivePreset" class="bg-blue-500 text-white px-3 py-1 rounded-lg text-sm">
                            ‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
                        </button>
                        <button id="resetChecklist" class="bg-gray-500 text-white px-3 py-1 rounded-lg text-sm">
                            üîÑ ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï
                        </button>
                    </div>
                </div>
                
                <div id="checklistItems" class="space-y-3"></div>
                
                <div class="mt-6 p-4 bg-blue-50 rounded-lg">
                    <div class="flex justify-between items-center">
                        <span class="text-blue-800 font-medium">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∑‡∏ö‡∏´‡∏ô‡πâ‡∏≤:</span>
                        <span id="progressText" class="text-blue-600 font-bold">0/0</span>
                    </div>
                    <div class="w-full bg-blue-200 rounded-full h-2 mt-2">
                        <div id="progressBar" class="bg-blue-600 h-2 rounded-full transition-all duration-300" style="width: 0%"></div>
                    </div>
                </div>
            </div>

            <!-- Next Page Button -->
            <div class="mt-6">
                <button id="nextToCalculator" class="w-full gradient-bg text-white py-4 px-6 rounded-xl font-semibold text-lg transition-all hover:shadow-lg">
                    üßÆ ‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì ‚Üí
                </button>
            </div>
        </div>

        <!-- Calculator Page -->
        <div id="calculatorPage" class="hidden">
            <!-- Trading Type Selection -->
            <div class="bg-white rounded-xl card-shadow p-6 mb-6">
                <h2 class="text-lg font-semibold text-gray-800 mb-4">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Å‡∏≤‡∏£‡πÄ‡∏ó‡∏£‡∏î</h2>
                <div class="grid grid-cols-2 gap-3">
                    <button id="forexBtn" class="trading-type-btn bg-blue-500 text-white py-3 px-4 rounded-lg font-medium transition-all">
                        üí± Forex
                    </button>
                    <button id="cryptoBtn" class="trading-type-btn bg-gray-200 text-gray-700 py-3 px-4 rounded-lg font-medium transition-all">
                        ‚Çø Crypto
                    </button>
                </div>
            </div>

            <!-- Forex Calculator -->
            <div id="forexCalculator" class="bg-white rounded-xl card-shadow p-6 mb-6">
                <h3 class="text-lg font-semibold text-gray-800 mb-4">üî¢ ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì Lot Size Forex</h3>
                
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">‡∏™‡∏Å‡∏∏‡∏•‡πÄ‡∏á‡∏¥‡∏ô</label>
                        <select id="currencyPair" class="w-full p-3 border border-gray-300 rounded-lg input-focus">
                            <option value="EURUSD">EUR/USD</option>
                            <option value="GBPUSD">GBP/USD</option>
                            <option value="AUDUSD">AUD/USD</option>
                            <option value="NZDUSD">NZD/USD</option>
                            <option value="USDCHF">USD/CHF</option>
                            <option value="USDCAD">USD/CAD</option>
                            <option value="USDJPY">USD/JPY</option>
                            <option value="EURJPY">EUR/JPY</option>
                            <option value="GBPJPY">GBP/JPY</option>
                            <option value="AUDJPY">AUD/JPY</option>
                            <option value="NZDJPY">NZD/JPY</option>
                            <option value="CADJPY">CAD/JPY</option>
                            <option value="XAUUSD">XAU/USD (Gold)</option>
                            <option value="XAGUSD">XAG/USD (Silver)</option>
                            <option value="USOIL">US Oil</option>
                            <option value="UKOIL">UK Oil</option>
                            <option value="US30">US30</option>
                            <option value="NAS100">NAS100</option>
                            <option value="SPX500">SPX500</option>
                        </select>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">‡∏™‡∏Å‡∏∏‡∏•‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡∏ù‡∏≤‡∏Å</label>
                        <select id="accountCurrency" class="w-full p-3 border border-gray-300 rounded-lg input-focus">
                            <option value="USD">USD</option>
                            <option value="CENT">CENT</option>
                        </select>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">‡∏£‡∏≤‡∏Ñ‡∏≤‡πÄ‡∏õ‡∏¥‡∏î‡πÇ‡∏û‡∏ã‡∏¥‡∏ä‡∏±‡πà‡∏ô (‡∏à‡∏∏‡∏î‡πÄ‡∏Ç‡πâ‡∏≤)</label>
                        <input type="number" id="entryPrice" step="0.00001" class="w-full p-3 border border-gray-300 rounded-lg input-focus" placeholder="1.08500">
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">‡∏£‡∏≤‡∏Ñ‡∏≤ Stop Loss (SL)</label>
                        <input type="number" id="stopLoss" step="0.00001" class="w-full p-3 border border-gray-300 rounded-lg input-focus" placeholder="1.08000">
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô‡πÉ‡∏ô‡∏ö‡∏±‡∏ç‡∏ä‡∏µ</label>
                        <input type="number" id="accountBalance" step="0.01" class="w-full p-3 border border-gray-300 rounded-lg input-focus" placeholder="1000">
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á (%)</label>
                        <input type="number" id="riskPercent" step="0.1" max="100" class="w-full p-3 border border-gray-300 rounded-lg input-focus" placeholder="2">
                    </div>
                </div>
            </div>

            <!-- Crypto Calculator -->
            <div id="cryptoCalculator" class="bg-white rounded-xl card-shadow p-6 mb-6 hidden">
                <h3 class="text-lg font-semibold text-gray-800 mb-4">‚Çø ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì Position Size Crypto</h3>
                
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç‡∏Ñ‡∏£‡∏¥‡∏õ‡πÇ‡∏ï</label>
                        <select id="cryptoCoin" class="w-full p-3 border border-gray-300 rounded-lg input-focus">
                            <option value="BTCUSDT">BTC/USDT</option>
                            <option value="ETHUSDT">ETH/USDT</option>
                            <option value="BNBUSDT">BNB/USDT</option>
                            <option value="ADAUSDT">ADA/USDT</option>
                            <option value="SOLUSDT">SOL/USDT</option>
                            <option value="XRPUSDT">XRP/USDT</option>
                            <option value="DOTUSDT">DOT/USDT</option>
                            <option value="AVAXUSDT">AVAX/USDT</option>
                            <option value="MATICUSDT">MATIC/USDT</option>
                            <option value="LINKUSDT">LINK/USDT</option>
                        </select>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">‡∏£‡∏≤‡∏Ñ‡∏≤‡πÄ‡∏õ‡∏¥‡∏î‡πÇ‡∏û‡∏ã‡∏¥‡∏ä‡∏±‡πà‡∏ô (‡∏à‡∏∏‡∏î‡πÄ‡∏Ç‡πâ‡∏≤)</label>
                        <input type="number" id="cryptoEntryPrice" step="0.00001" class="w-full p-3 border border-gray-300 rounded-lg input-focus" placeholder="45000">
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">‡∏£‡∏≤‡∏Ñ‡∏≤ Stop Loss (SL)</label>
                        <input type="number" id="cryptoStopLoss" step="0.00001" class="w-full p-3 border border-gray-300 rounded-lg input-focus" placeholder="44000">
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô‡πÉ‡∏ô‡∏ö‡∏±‡∏ç‡∏ä‡∏µ (USDT)</label>
                        <input type="number" id="cryptoAccountBalance" step="0.01" class="w-full p-3 border border-gray-300 rounded-lg input-focus" placeholder="1000">
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Leverage (‡πÄ‡∏ó‡πà‡∏≤)</label>
                        <input type="number" id="leverage" step="1" min="1" max="125" class="w-full p-3 border border-gray-300 rounded-lg input-focus" placeholder="10">
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á (%)</label>
                        <input type="number" id="cryptoRiskPercent" step="0.1" max="100" class="w-full p-3 border border-gray-300 rounded-lg input-focus" placeholder="2">
                    </div>
                </div>
            </div>

            <!-- Calculate Button -->
            <button id="calculateBtn" class="w-full gradient-bg text-white py-4 px-6 rounded-xl font-semibold text-lg mb-6 transition-all hover:shadow-lg">
                üßÆ ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì
            </button>

            <!-- Results -->
            <div id="results" class="bg-white rounded-xl card-shadow p-6 hidden">
                <h3 class="text-lg font-semibold text-gray-800 mb-4">üìä ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì</h3>
                <div id="resultContent" class="space-y-3"></div>
                
                <!-- Save Confirmation -->
                <div id="saveConfirmation" class="mt-6 p-4 bg-yellow-50 rounded-lg border border-yellow-200 hidden">
                    <p class="text-sm text-yellow-800 mb-3">üíæ ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏ô‡∏µ‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?</p>
                    <div class="flex gap-3">
                        <button id="confirmSave" class="flex-1 bg-green-500 text-white py-2 px-4 rounded-lg text-sm font-medium">
                            ‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å
                        </button>
                        <button id="cancelSave" class="flex-1 bg-gray-300 text-gray-700 py-2 px-4 rounded-lg text-sm font-medium">
                            ‚ùå ‡πÑ‡∏°‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å
                        </button>
                    </div>
                </div>
            </div>


        </div>

        <!-- Records Page -->
        <div id="recordsPage" class="hidden">
            <div class="bg-white rounded-xl card-shadow p-6 mb-6">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-lg font-semibold text-gray-800">üìù ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏ó‡∏£‡∏î</h2>
                    <div class="flex gap-2">
                        <button id="sortNewest" class="sort-btn bg-blue-500 text-white px-3 py-1 rounded-lg text-sm font-medium transition-all">
                            ‚¨áÔ∏è ‡πÉ‡∏´‡∏°‡πà-‡πÄ‡∏Å‡πà‡∏≤
                        </button>
                        <button id="sortOldest" class="sort-btn bg-gray-200 text-gray-700 px-3 py-1 rounded-lg text-sm font-medium transition-all">
                            ‚¨ÜÔ∏è ‡πÄ‡∏Å‡πà‡∏≤-‡πÉ‡∏´‡∏°‡πà
                        </button>
                    </div>
                </div>
                <div id="recordsList" class="space-y-4">
                    <p class="text-gray-500 text-center py-8">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏ó‡∏£‡∏î</p>
                </div>
            </div>


        </div>

        <!-- Statistics Page -->
        <div id="statsPage" class="hidden">
            <div class="bg-white rounded-xl card-shadow p-6 mb-6">
                <h2 class="text-lg font-semibold text-gray-800 mb-4">üìä ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÄ‡∏ó‡∏£‡∏î</h2>
                <div id="statsContent">
                    <div class="grid grid-cols-2 gap-4 mb-6">
                        <div class="bg-blue-50 p-4 rounded-lg text-center">
                            <div class="text-2xl font-bold text-blue-600" id="totalTrades">0</div>
                            <div class="text-sm text-gray-600">‡πÄ‡∏ó‡∏£‡∏î‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</div>
                        </div>
                        <div class="bg-green-50 p-4 rounded-lg text-center">
                            <div class="text-2xl font-bold text-green-600" id="winRate">0%</div>
                            <div class="text-sm text-gray-600">‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏ä‡∏ô‡∏∞</div>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-4 mb-6">
                        <div class="bg-emerald-50 p-4 rounded-lg text-center">
                            <div class="text-lg font-bold text-emerald-600" id="totalProfit">0</div>
                            <div class="text-sm text-gray-600">‡∏Å‡∏≥‡πÑ‡∏£‡∏£‡∏ß‡∏°</div>
                        </div>
                        <div class="bg-red-50 p-4 rounded-lg text-center">
                            <div class="text-lg font-bold text-red-600" id="totalLoss">0</div>
                            <div class="text-sm text-gray-600">‡∏Ç‡∏≤‡∏î‡∏ó‡∏∏‡∏ô‡∏£‡∏ß‡∏°</div>
                        </div>
                    </div>
                    
                    <div class="bg-purple-50 p-4 rounded-lg text-center mb-6">
                        <div class="text-lg font-bold text-purple-600" id="avgRR">0:0</div>
                        <div class="text-sm text-gray-600">‡∏Ñ‡πà‡∏≤‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢ R:R</div>
                    </div>
                    
                    <div class="bg-gray-50 p-4 rounded-lg mb-6">
                        <h3 class="font-semibold text-gray-800 mb-3">üìà ‡∏Å‡∏£‡∏≤‡∏ü‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏ó‡∏£‡∏î</h3>
                        <div id="chartContainer" class="h-32 flex items-end justify-center space-x-2">
                            <div class="text-gray-400 text-sm">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏û‡∏≠‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏™‡∏î‡∏á‡∏Å‡∏£‡∏≤‡∏ü</div>
                        </div>
                    </div>
                    
                    <div class="bg-white rounded-xl card-shadow p-6">
                        <h3 class="text-lg font-semibold text-gray-800 mb-4">üìã ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏ï‡∏≤‡∏°‡∏û‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï</h3>
                        <div id="presetStats">
                            <p class="text-gray-500 text-center py-4">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏ó‡∏£‡∏î‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏û‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Create/Edit Preset Modal -->
        <div id="presetModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50">
            <div class="flex items-center justify-center min-h-screen p-4">
                <div class="bg-white rounded-xl max-w-md w-full p-6 max-h-[90vh] overflow-y-auto">
                    <h3 id="presetModalTitle" class="text-lg font-semibold text-gray-800 mb-4">üìã ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏û‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡πÉ‡∏´‡∏°‡πà</h3>
                    
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">‡∏ä‡∏∑‡πà‡∏≠‡∏û‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï</label>
                            <input type="text" id="presetName" class="w-full p-3 border border-gray-300 rounded-lg input-focus" placeholder="‡πÄ‡∏ä‡πà‡∏ô: ‡πÄ‡∏ä‡πá‡∏Ñ‡∏•‡∏¥‡∏™‡∏ï‡πå‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏ó‡∏£‡∏î">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡πá‡∏Ñ‡∏•‡∏¥‡∏™‡∏ï‡πå</label>
                            <div id="checklistItemsEditor" class="space-y-2">
                                <div class="flex gap-2">
                                    <input type="text" class="flex-1 p-2 border border-gray-300 rounded-lg text-sm" placeholder="‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà 1">
                                    <button class="remove-item bg-red-500 text-white px-3 py-2 rounded-lg text-sm">üóëÔ∏è</button>
                                </div>
                            </div>
                            <button id="addItemBtn" class="mt-2 bg-green-500 text-white px-4 py-2 rounded-lg text-sm font-medium w-full">
                                ‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£
                            </button>
                        </div>
                    </div>
                    
                    <div class="flex gap-3 mt-6">
                        <button id="savePreset" class="flex-1 bg-blue-500 text-white py-3 px-4 rounded-lg font-medium">
                            üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å
                        </button>
                        <button id="cancelPreset" class="flex-1 bg-gray-300 text-gray-700 py-3 px-4 rounded-lg font-medium">
                            ‚ùå ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Edit Record Modal -->
        <div id="editModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50">
            <div class="flex items-center justify-center min-h-screen p-4">
                <div class="bg-white rounded-xl max-w-md w-full p-6 max-h-[90vh] overflow-y-auto">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4">‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏ó‡∏£‡∏î</h3>
                    
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á</label>
                            <select id="editOrderType" class="w-full p-3 border border-gray-300 rounded-lg input-focus">
                                <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á</option>
                                <option value="Buy">Buy</option>
                                <option value="Sell">Sell</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">‡∏à‡∏∏‡∏î TP (Target Profit)</label>
                            <input type="number" id="editTP" step="0.00001" class="w-full p-3 border border-gray-300 rounded-lg input-focus" placeholder="‡∏£‡∏≤‡∏Ñ‡∏≤‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏Å‡∏≤‡∏£‡πÄ‡∏ó‡∏£‡∏î</label>
                            <select id="editResult" class="w-full p-3 border border-gray-300 rounded-lg input-focus">
                                <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå</option>
                                <option value="Win">Win</option>
                                <option value="Loss">Loss</option>
                            </select>
                        </div>
                        
                        <div id="editProfitSection" class="hidden">
                            <label class="block text-sm font-medium text-gray-700 mb-2">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡∏ä‡∏ô‡∏∞</label>
                            <input type="number" id="editProfitAmount" step="0.01" class="w-full p-3 border border-green-300 rounded-lg bg-green-50" readonly>
                        </div>
                        
                        <div id="editLossSection" class="hidden">
                            <label class="block text-sm font-medium text-gray-700 mb-2">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏™‡∏µ‡∏¢</label>
                            <input type="number" id="editLossAmount" step="0.01" class="w-full p-3 border border-red-300 rounded-lg bg-red-50" readonly>
                            
                            <label class="block text-sm font-medium text-gray-700 mb-2 mt-4">‡∏™‡∏≤‡πÄ‡∏´‡∏ï‡∏∏‡∏Å‡∏≤‡∏£‡πÅ‡∏û‡πâ</label>
                            <select id="editLossReason" class="w-full p-3 border border-gray-300 rounded-lg input-focus mb-2">
                                <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏≤‡πÄ‡∏´‡∏ï‡∏∏‡∏Å‡∏≤‡∏£‡πÅ‡∏û‡πâ</option>
                                <option value="‡πÑ‡∏°‡πà‡∏ó‡∏≥‡∏ï‡∏≤‡∏° SL">‡πÑ‡∏°‡πà‡∏ó‡∏≥‡∏ï‡∏≤‡∏° SL</option>
                                <option value="‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏ú‡∏¥‡∏î">‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏ú‡∏¥‡∏î</option>
                                <option value="‡∏Ç‡πà‡∏≤‡∏ß‡∏Å‡∏£‡∏∞‡∏ó‡∏ö">‡∏Ç‡πà‡∏≤‡∏ß‡∏Å‡∏£‡∏∞‡∏ó‡∏ö</option>
                                <option value="‡πÄ‡∏Ç‡πâ‡∏≤‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏∞‡∏ú‡∏¥‡∏î">‡πÄ‡∏Ç‡πâ‡∏≤‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏∞‡∏ú‡∏¥‡∏î</option>
                                <option value="‡∏ï‡∏•‡∏≤‡∏î‡∏ú‡∏±‡∏ô‡∏ú‡∏ß‡∏ô">‡∏ï‡∏•‡∏≤‡∏î‡∏ú‡∏±‡∏ô‡∏ú‡∏ß‡∏ô</option>
                                <option value="‡πÑ‡∏°‡πà‡∏ó‡∏≥‡∏ï‡∏≤‡∏°‡πÅ‡∏ú‡∏ô">‡πÑ‡∏°‡πà‡∏ó‡∏≥‡∏ï‡∏≤‡∏°‡πÅ‡∏ú‡∏ô</option>
                                <option value="‡∏≠‡∏≤‡∏£‡∏°‡∏ì‡πå‡πÄ‡∏Ç‡πâ‡∏≤‡∏°‡∏≤‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß">‡∏≠‡∏≤‡∏£‡∏°‡∏ì‡πå‡πÄ‡∏Ç‡πâ‡∏≤‡∏°‡∏≤‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß</option>
                                <option value="‡∏≠‡∏∑‡πà‡∏ô‡πÜ">‡∏≠‡∏∑‡πà‡∏ô‡πÜ</option>
                            </select>
                            
                            <div id="customLossReasonSection" class="hidden">
                                <label class="block text-sm font-medium text-gray-700 mb-2">‡∏£‡∏∞‡∏ö‡∏∏‡∏™‡∏≤‡πÄ‡∏´‡∏ï‡∏∏‡∏≠‡∏∑‡πà‡∏ô‡πÜ</label>
                                <textarea id="editCustomLossReason" class="w-full p-3 border border-gray-300 rounded-lg input-focus" rows="2" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏™‡∏≤‡πÄ‡∏´‡∏ï‡∏∏‡∏Å‡∏≤‡∏£‡πÅ‡∏û‡πâ..."></textarea>
                            </div>
                        </div>
                        
                        <div id="editRRSection" class="hidden">
                            <label class="block text-sm font-medium text-gray-700 mb-2">R:R Ratio</label>
                            <input type="text" id="editRR" class="w-full p-3 border border-gray-300 rounded-lg bg-gray-50" readonly>
                        </div>
                    </div>
                    
                    <div class="flex gap-3 mt-6">
                        <button id="saveEdit" class="flex-1 bg-blue-500 text-white py-3 px-4 rounded-lg font-medium">
                            üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å
                        </button>
                        <button id="cancelEdit" class="flex-1 bg-gray-300 text-gray-700 py-3 px-4 rounded-lg font-medium">
                            ‚ùå ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
                        </button>
                        <button id="deleteRecord" class="bg-red-500 text-white py-3 px-4 rounded-lg font-medium">
                            üóëÔ∏è
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const pipSettings = {
            // üîπ ‡∏Ñ‡∏π‡πà‡πÄ‡∏á‡∏¥‡∏ô‡∏´‡∏•‡∏±‡∏Å (USD pairs, pip = 0.0001) ‚Üí pipValue ‡∏ï‡πà‡∏≠ 1.0 lot = 10 USD
            "EURUSD": { multiplier: 10000, pipValue: 10 },
            "GBPUSD": { multiplier: 10000, pipValue: 10 },
            "AUDUSD": { multiplier: 10000, pipValue: 10 },
            "NZDUSD": { multiplier: 10000, pipValue: 10 },
            "USDCHF": { multiplier: 10000, pipValue: 10 },
            "USDCAD": { multiplier: 10000, pipValue: 10 },

            // üî∏ ‡∏Ñ‡∏π‡πà‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡∏°‡∏µ JPY (JPY pairs, pip = 0.01) ‚Üí ‡∏õ‡∏£‡∏±‡∏ö pipValue ‡∏ï‡∏≤‡∏°‡∏™‡∏π‡∏ï‡∏£‡πÉ‡∏´‡∏°‡πà
            "USDJPY": { multiplier: 100, pipValue: 7.0 },
            "EURJPY": { multiplier: 100, pipValue: 7.2 },
            "GBPJPY": { multiplier: 100, pipValue: 7.5 },
            "AUDJPY": { multiplier: 100, pipValue: 7.0 },
            "NZDJPY": { multiplier: 100, pipValue: 6.8 },
            "CADJPY": { multiplier: 100, pipValue: 7.1 },

            // üü° ‡∏ó‡∏≠‡∏á‡∏Ñ‡∏≥ (XAUUSD) ‚Üí ‡∏£‡∏≤‡∏Ñ‡∏≤‡∏Ç‡∏¢‡∏±‡∏ö 1.00 = 100 USD
            "XAUUSD": { multiplier: 1, pipValue: 100 },

            // ‚ö™ ‡πÄ‡∏á‡∏¥‡∏ô (XAGUSD) ‚Üí ‡∏£‡∏≤‡∏Ñ‡∏≤‡∏Ç‡∏¢‡∏±‡∏ö 1.00 = ~50 USD
            "XAGUSD": { multiplier: 1, pipValue: 50 },

            // üõ¢ ‡∏ô‡πâ‡∏≥‡∏°‡∏±‡∏ô (USOIL, UKOIL) ‚Üí ‡∏£‡∏≤‡∏Ñ‡∏≤‡∏Ç‡∏¢‡∏±‡∏ö 1.00 = 10 USD
            "USOIL": { multiplier: 1, pipValue: 10 },
            "UKOIL": { multiplier: 1, pipValue: 10 },

            // üìä ‡∏î‡∏±‡∏ä‡∏ô‡∏µ ‚Üí ‡∏£‡∏≤‡∏Ñ‡∏≤‡∏Ç‡∏¢‡∏±‡∏ö 1.00 = 1 USD
            "US30": { multiplier: 1, pipValue: 1 },
            "NAS100": { multiplier: 1, pipValue: 1 },
            "SPX500": { multiplier: 1, pipValue: 1 }
        };

        let currentMode = 'forex';
        let currentPage = 'checklist';
        let currentCalculationData = null;
        let currentEditingId = null;
        let currentEditingPresetId = null;
        let activePresetId = null;
        let tradingRecords = JSON.parse(localStorage.getItem('tradingRecords') || '[]');
        let checklistPresets = JSON.parse(localStorage.getItem('checklistPresets') || '[]');
        let checklistStates = JSON.parse(localStorage.getItem('checklistStates') || '{}');
        let sortOrder = 'newest';

        // Default presets if none exist
        if (checklistPresets.length === 0) {
            checklistPresets = [
                {
                    id: 1,
                    name: "‡πÄ‡∏ä‡πá‡∏Ñ‡∏•‡∏¥‡∏™‡∏ï‡πå‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏ó‡∏£‡∏î",
                    items: [
                        "‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡πà‡∏≤‡∏ß‡∏™‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç",
                        "‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏Å‡∏£‡∏≤‡∏ü‡πÅ‡∏•‡∏∞‡πÅ‡∏ô‡∏ß‡πÇ‡∏ô‡πâ‡∏°",
                        "‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏à‡∏∏‡∏î‡πÄ‡∏Ç‡πâ‡∏≤‡πÅ‡∏•‡∏∞‡∏≠‡∏≠‡∏Å",
                        "‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì Risk Management",
                        "‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏†‡∏≤‡∏û‡∏à‡∏¥‡∏ï‡πÉ‡∏à"
                    ]
                }
            ];
            localStorage.setItem('checklistPresets', JSON.stringify(checklistPresets));
        }

        // Check daily limit
        function checkDailyLimit() {
            const today = new Date().toDateString();
            const todayRecords = tradingRecords.filter(record => 
                new Date(record.date).toDateString() === today
            );
            
            if (todayRecords.length >= 5) {
                const now = new Date();
                const tomorrow6AM = new Date();
                tomorrow6AM.setDate(tomorrow6AM.getDate() + 1);
                tomorrow6AM.setHours(6, 0, 0, 0);
                
                if (now < tomorrow6AM) {
                    document.getElementById('dailyLimitWarning').classList.remove('hidden');
                    document.getElementById('calculatorTab').disabled = true;
                    document.getElementById('calculatorTab').classList.add('opacity-50');
                    return true;
                }
            }
            return false;
        }

        // Navigation
        document.getElementById('checklistTab').addEventListener('click', () => {
            switchPage('checklist');
        });

        document.getElementById('calculatorTab').addEventListener('click', () => {
            if (checkDailyLimit()) return;
            switchPage('calculator');
        });

        document.getElementById('recordsTab').addEventListener('click', () => {
            switchPage('records');
        });

        document.getElementById('statsTab').addEventListener('click', () => {
            switchPage('stats');
        });

        // Next page button
        document.getElementById('nextToCalculator').addEventListener('click', () => {
            if (checkDailyLimit()) return;
            switchPage('calculator');
        });

        function switchPage(page) {
            currentPage = page;
            
            // Update navigation
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.className = 'nav-btn bg-gray-200 text-gray-700 py-2 px-2 rounded-lg text-xs font-medium transition-all';
            });
            
            // Hide all pages
            document.getElementById('checklistPage').classList.add('hidden');
            document.getElementById('calculatorPage').classList.add('hidden');
            document.getElementById('recordsPage').classList.add('hidden');
            document.getElementById('statsPage').classList.add('hidden');
            
            if (page === 'checklist') {
                document.getElementById('checklistTab').className = 'nav-btn bg-blue-500 text-white py-2 px-2 rounded-lg text-xs font-medium transition-all';
                document.getElementById('checklistPage').classList.remove('hidden');
                loadPresets();
            } else if (page === 'calculator') {
                document.getElementById('calculatorTab').className = 'nav-btn bg-blue-500 text-white py-2 px-2 rounded-lg text-xs font-medium transition-all';
                document.getElementById('calculatorPage').classList.remove('hidden');
            } else if (page === 'records') {
                document.getElementById('recordsTab').className = 'nav-btn bg-blue-500 text-white py-2 px-2 rounded-lg text-xs font-medium transition-all';
                document.getElementById('recordsPage').classList.remove('hidden');
                loadRecords();
            } else if (page === 'stats') {
                document.getElementById('statsTab').className = 'nav-btn bg-blue-500 text-white py-2 px-2 rounded-lg text-xs font-medium transition-all';
                document.getElementById('statsPage').classList.remove('hidden');
                loadStats();
            }
        }

        // Preset Management
        function loadPresets() {
            const presetSelector = document.getElementById('presetSelector');
            const presetActions = document.getElementById('presetActions');
            
            // Clear existing options
            presetSelector.innerHTML = '<option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏û‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï --</option>';
            
            if (checklistPresets.length === 0) {
                presetActions.classList.add('hidden');
                return;
            }

            // Populate dropdown options
            checklistPresets.forEach(preset => {
                const option = document.createElement('option');
                option.value = preset.id;
                option.textContent = `${preset.name} (${preset.items.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£)`;
                presetSelector.appendChild(option);
            });

            // Set selected value if there's an active preset
            if (activePresetId) {
                presetSelector.value = activePresetId;
                presetActions.classList.remove('hidden');
                loadActiveChecklist();
            } else {
                presetActions.classList.add('hidden');
            }
        }

        function selectPreset(presetId) {
            activePresetId = presetId;
            localStorage.setItem('activePresetId', presetId);
            loadPresets();
            loadActiveChecklist();
        }

        // Preset selector event listener
        document.getElementById('presetSelector').addEventListener('change', (e) => {
            const selectedId = parseInt(e.target.value);
            if (selectedId) {
                selectPreset(selectedId);
                document.getElementById('presetActions').classList.remove('hidden');
            } else {
                activePresetId = null;
                localStorage.removeItem('activePresetId');
                document.getElementById('presetActions').classList.add('hidden');
                document.getElementById('activeChecklistSection').classList.add('hidden');
            }
        });

        // Preset action buttons
        document.getElementById('editSelectedPreset').addEventListener('click', () => {
            if (activePresetId) {
                editPreset(activePresetId);
            }
        });

        document.getElementById('deleteSelectedPreset').addEventListener('click', () => {
            if (activePresetId) {
                deletePreset(activePresetId);
            }
        });

        function loadActiveChecklist() {
            const preset = checklistPresets.find(p => p.id === activePresetId);
            if (!preset) return;

            document.getElementById('activePresetName').textContent = preset.name;
            document.getElementById('activeChecklistSection').classList.remove('hidden');

            const checklistItems = document.getElementById('checklistItems');
            const currentState = checklistStates[activePresetId] || {};

            const itemsHTML = preset.items.map((item, index) => {
                const isChecked = currentState[index] || false;
                return `
                    <div class="flex items-center gap-3 p-3 bg-gray-50 rounded-lg">
                        <input type="checkbox" id="item_${index}" ${isChecked ? 'checked' : ''} 
                               onchange="toggleChecklistItem(${index})"
                               class="w-5 h-5 text-blue-600 rounded focus:ring-blue-500">
                        <label for="item_${index}" class="flex-1 text-gray-800 ${isChecked ? 'line-through text-gray-500' : ''}">
                            ${item}
                        </label>
                    </div>
                `;
            }).join('');

            checklistItems.innerHTML = itemsHTML;
            updateProgress();
        }

        function toggleChecklistItem(index) {
            if (!checklistStates[activePresetId]) {
                checklistStates[activePresetId] = {};
            }
            
            checklistStates[activePresetId][index] = !checklistStates[activePresetId][index];
            localStorage.setItem('checklistStates', JSON.stringify(checklistStates));
            
            loadActiveChecklist();
        }

        function updateProgress() {
            const preset = checklistPresets.find(p => p.id === activePresetId);
            if (!preset) return;

            const currentState = checklistStates[activePresetId] || {};
            const completed = Object.values(currentState).filter(Boolean).length;
            const total = preset.items.length;
            const percentage = total > 0 ? (completed / total) * 100 : 0;

            document.getElementById('progressText').textContent = `${completed}/${total}`;
            document.getElementById('progressBar').style.width = `${percentage}%`;
        }

        // Preset CRUD Operations
        document.getElementById('createPresetBtn').addEventListener('click', () => {
            if (checklistPresets.length >= 3) {
                alert('‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏û‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡πÑ‡∏î‡πâ‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î 3 ‡πÅ‡∏ú‡∏ô‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô');
                return;
            }
            openPresetModal();
        });

        function editPreset(presetId) {
            const preset = checklistPresets.find(p => p.id === presetId);
            if (!preset) return;
            
            currentEditingPresetId = presetId;
            openPresetModal(preset);
        }

        function deletePreset(presetId) {
            if (confirm('‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏û‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏ô‡∏µ‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')) {
                checklistPresets = checklistPresets.filter(p => p.id !== presetId);
                delete checklistStates[presetId];
                
                if (activePresetId === presetId) {
                    activePresetId = null;
                    localStorage.removeItem('activePresetId');
                    document.getElementById('activeChecklistSection').classList.add('hidden');
                    document.getElementById('presetActions').classList.add('hidden');
                }
                
                localStorage.setItem('checklistPresets', JSON.stringify(checklistPresets));
                localStorage.setItem('checklistStates', JSON.stringify(checklistStates));
                loadPresets();
            }
        }

        function openPresetModal(preset = null) {
            const modal = document.getElementById('presetModal');
            const title = document.getElementById('presetModalTitle');
            const nameInput = document.getElementById('presetName');
            const itemsEditor = document.getElementById('checklistItemsEditor');

            if (preset) {
                title.textContent = '‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏û‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï';
                nameInput.value = preset.name;
                
                itemsEditor.innerHTML = preset.items.map(item => `
                    <div class="flex gap-2">
                        <input type="text" class="flex-1 p-2 border border-gray-300 rounded-lg text-sm" value="${item}">
                        <button class="remove-item bg-red-500 text-white px-3 py-2 rounded-lg text-sm">üóëÔ∏è</button>
                    </div>
                `).join('');
            } else {
                title.textContent = 'üìã ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏û‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡πÉ‡∏´‡∏°‡πà';
                nameInput.value = '';
                
                itemsEditor.innerHTML = `
                    <div class="flex gap-2">
                        <input type="text" class="flex-1 p-2 border border-gray-300 rounded-lg text-sm" placeholder="‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà 1">
                        <button class="remove-item bg-red-500 text-white px-3 py-2 rounded-lg text-sm">üóëÔ∏è</button>
                    </div>
                `;
            }

            modal.classList.remove('hidden');
            setupItemEditor();
        }

        function setupItemEditor() {
            // Add item button
            document.getElementById('addItemBtn').onclick = () => {
                const itemsEditor = document.getElementById('checklistItemsEditor');
                const newItem = document.createElement('div');
                newItem.className = 'flex gap-2';
                newItem.innerHTML = `
                    <input type="text" class="flex-1 p-2 border border-gray-300 rounded-lg text-sm" placeholder="‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡∏°‡πà">
                    <button class="remove-item bg-red-500 text-white px-3 py-2 rounded-lg text-sm">üóëÔ∏è</button>
                `;
                itemsEditor.appendChild(newItem);
                setupRemoveButtons();
            };

            setupRemoveButtons();
        }

        function setupRemoveButtons() {
            document.querySelectorAll('.remove-item').forEach(btn => {
                btn.onclick = (e) => {
                    const itemsEditor = document.getElementById('checklistItemsEditor');
                    if (itemsEditor.children.length > 1) {
                        e.target.parentElement.remove();
                    } else {
                        alert('‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£');
                    }
                };
            });
        }

        // Save preset
        document.getElementById('savePreset').addEventListener('click', () => {
            const name = document.getElementById('presetName').value.trim();
            const itemInputs = document.querySelectorAll('#checklistItemsEditor input');
            const items = Array.from(itemInputs).map(input => input.value.trim()).filter(item => item);

            if (!name) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏ä‡∏∑‡πà‡∏≠‡∏û‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï');
                return;
            }

            if (items.length === 0) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£');
                return;
            }

            if (currentEditingPresetId) {
                // Edit existing preset
                const presetIndex = checklistPresets.findIndex(p => p.id === currentEditingPresetId);
                if (presetIndex !== -1) {
                    checklistPresets[presetIndex] = {
                        ...checklistPresets[presetIndex],
                        name,
                        items
                    };
                }
                currentEditingPresetId = null;
            } else {
                // Create new preset
                const newPreset = {
                    id: Date.now(),
                    name,
                    items
                };
                checklistPresets.push(newPreset);
            }

            localStorage.setItem('checklistPresets', JSON.stringify(checklistPresets));
            document.getElementById('presetModal').classList.add('hidden');
            loadPresets();
        });

        // Cancel preset
        document.getElementById('cancelPreset').addEventListener('click', () => {
            document.getElementById('presetModal').classList.add('hidden');
            currentEditingPresetId = null;
        });

        // Reset checklist
        document.getElementById('resetChecklist').addEventListener('click', () => {
            if (activePresetId && confirm('‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡πÄ‡∏ä‡πá‡∏Ñ‡∏•‡∏¥‡∏™‡∏ï‡πå‡∏ô‡∏µ‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')) {
                delete checklistStates[activePresetId];
                localStorage.setItem('checklistStates', JSON.stringify(checklistStates));
                loadActiveChecklist();
                alert('‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡πÄ‡∏ä‡πá‡∏Ñ‡∏•‡∏¥‡∏™‡∏ï‡πå‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß!');
            }
        });

        // Edit active preset
        document.getElementById('editActivePreset').addEventListener('click', () => {
            if (activePresetId) {
                editPreset(activePresetId);
            }
        });

        // Trading type selection
        document.getElementById('forexBtn').addEventListener('click', () => {
            currentMode = 'forex';
            document.getElementById('forexBtn').className = 'trading-type-btn bg-blue-500 text-white py-3 px-4 rounded-lg font-medium transition-all';
            document.getElementById('cryptoBtn').className = 'trading-type-btn bg-gray-200 text-gray-700 py-3 px-4 rounded-lg font-medium transition-all';
            document.getElementById('forexCalculator').classList.remove('hidden');
            document.getElementById('cryptoCalculator').classList.add('hidden');
            document.getElementById('results').classList.add('hidden');
        });

        document.getElementById('cryptoBtn').addEventListener('click', () => {
            currentMode = 'crypto';
            document.getElementById('cryptoBtn').className = 'trading-type-btn bg-blue-500 text-white py-3 px-4 rounded-lg font-medium transition-all';
            document.getElementById('forexBtn').className = 'trading-type-btn bg-gray-200 text-gray-700 py-3 px-4 rounded-lg font-medium transition-all';
            document.getElementById('cryptoCalculator').classList.remove('hidden');
            document.getElementById('forexCalculator').classList.add('hidden');
            document.getElementById('results').classList.add('hidden');
        });



        // Calculate function
        document.getElementById('calculateBtn').addEventListener('click', () => {
            if (checkDailyLimit()) return;
            
            if (currentMode === 'forex') {
                calculateForex();
            } else {
                calculateCrypto();
            }
        });



        function calculateForex() {
            const currencyPair = document.getElementById('currencyPair').value;
            const accountCurrency = document.getElementById('accountCurrency').value;
            const entryPrice = parseFloat(document.getElementById('entryPrice').value);
            const stopLoss = parseFloat(document.getElementById('stopLoss').value);
            const accountBalance = parseFloat(document.getElementById('accountBalance').value);
            const riskPercent = parseFloat(document.getElementById('riskPercent').value);

            if (!entryPrice || !stopLoss || !accountBalance || !riskPercent) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô');
                return;
            }

            const pipSetting = pipSettings[currencyPair];
            const riskAmount = (accountBalance * riskPercent) / 100;
            const pipDifference = Math.abs(entryPrice - stopLoss) * pipSetting.multiplier;
            const lotSize = riskAmount / (pipDifference * pipSetting.pipValue);

            let standardLots = lotSize;
            let microLots = lotSize * 100;

            // Store calculation data for saving
            currentCalculationData = {
                type: 'forex',
                currencyPair,
                accountCurrency,
                entryPrice,
                stopLoss,
                accountBalance,
                riskPercent,
                riskAmount,
                lotSize: standardLots,
                microLots: accountCurrency === 'CENT' ? microLots : null
            };

            let resultHTML = `
                <div class="bg-blue-50 p-4 rounded-lg mb-4">
                    <h4 class="font-semibold text-blue-800 mb-2">üìà ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì Forex</h4>
                    <p class="text-sm text-gray-600 mb-2">‡∏Ñ‡∏π‡πà‡πÄ‡∏á‡∏¥‡∏ô: <span class="font-medium">${currencyPair}</span></p>
                    <p class="text-sm text-gray-600 mb-2">‡∏à‡∏∏‡∏î‡πÄ‡∏Ç‡πâ‡∏≤: <span class="font-medium">${entryPrice}</span></p>
                    <p class="text-sm text-gray-600 mb-2">Stop Loss: <span class="font-medium">${stopLoss}</span></p>
                </div>
                
                <div class="space-y-3">
                    <div class="flex justify-between items-center py-2 border-b">
                        <span class="text-gray-600">Standard Lots:</span>
                        <span class="font-semibold text-blue-600">${standardLots.toFixed(2)}</span>
                    </div>
            `;

            if (accountCurrency === 'CENT') {
                resultHTML += `
                    <div class="flex justify-between items-center py-2 border-b">
                        <span class="text-gray-600">Micro Lots:</span>
                        <span class="font-semibold text-blue-600">${microLots.toFixed(2)}</span>
                    </div>
                `;
            }

            resultHTML += `
                    <div class="flex justify-between items-center py-2 border-b">
                        <span class="text-gray-600">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏∞‡πÄ‡∏™‡∏µ‡∏¢‡∏´‡∏≤‡∏Å SL:</span>
                        <span class="font-semibold text-red-600">${riskAmount.toFixed(2)} ${accountCurrency}</span>
                    </div>
                </div>
                
                <div class="bg-green-50 p-4 rounded-lg mt-4">
                    <p class="text-sm text-green-700">üí° TP ‡∏ï‡∏≤‡∏°‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°‡∏Ñ‡∏ß‡∏£ 1:2 ‡∏Ç‡∏∂‡πâ‡∏ô‡πÑ‡∏õ ‡∏´‡∏≤‡∏Å‡∏°‡∏±‡πà‡∏ô‡πÉ‡∏à‡∏≠‡∏≤‡∏à‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô SL ‡∏°‡∏≤‡∏à‡∏∏‡∏î‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏î‡πâ</p>
                </div>
            `;

            if (riskPercent > 30) {
                resultHTML += `
                    <div class="bg-red-50 p-4 rounded-lg mt-4">
                        <p class="text-sm text-red-700 font-medium">‚ö†Ô∏è ‡πÅ‡∏û‡πâ‡πÅ‡∏•‡πâ‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏£‡πâ‡∏≠‡∏á‡∏ô‡∏∞‡∏™‡∏±‡∏™‡∏ñ‡πâ‡∏≤‡∏à‡∏∞‡πÄ‡∏¢‡∏≠‡∏∞‡∏Ç‡∏ô‡∏≤‡∏î‡∏ô‡∏µ‡πâ</p>
                    </div>
                `;
            }

            document.getElementById('resultContent').innerHTML = resultHTML;
            document.getElementById('results').classList.remove('hidden');
            document.getElementById('saveConfirmation').classList.remove('hidden');
        }

        function calculateCrypto() {
            const cryptoCoin = document.getElementById('cryptoCoin').value;
            const entryPrice = parseFloat(document.getElementById('cryptoEntryPrice').value);
            const stopLoss = parseFloat(document.getElementById('cryptoStopLoss').value);
            const accountBalance = parseFloat(document.getElementById('cryptoAccountBalance').value);
            const leverage = parseFloat(document.getElementById('leverage').value);
            const riskPercent = parseFloat(document.getElementById('cryptoRiskPercent').value);

            if (!entryPrice || !stopLoss || !accountBalance || !leverage || !riskPercent) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô');
                return;
            }

            const riskAmount = (accountBalance * riskPercent) / 100;
            const priceRiskPercent = Math.abs(entryPrice - stopLoss) / entryPrice;
            const margin = riskAmount / (priceRiskPercent * leverage);

            // Store calculation data for saving
            currentCalculationData = {
                type: 'crypto',
                cryptoCoin,
                entryPrice,
                stopLoss,
                accountBalance,
                leverage,
                riskPercent,
                riskAmount,
                margin
            };

            let resultHTML = `
                <div class="bg-blue-50 p-4 rounded-lg mb-4">
                    <h4 class="font-semibold text-blue-800 mb-2">‚Çø ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì Crypto</h4>
                    <p class="text-sm text-gray-600 mb-2">‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç: <span class="font-medium">${cryptoCoin}</span></p>
                    <p class="text-sm text-gray-600 mb-2">‡∏à‡∏∏‡∏î‡πÄ‡∏Ç‡πâ‡∏≤: <span class="font-medium">${entryPrice}</span></p>
                    <p class="text-sm text-gray-600 mb-2">Stop Loss: <span class="font-medium">${stopLoss}</span></p>
                    <p class="text-sm text-gray-600 mb-2">Leverage: <span class="font-medium">${leverage}x</span></p>
                </div>
                
                <div class="space-y-3">
                    <div class="flex justify-between items-center py-2 border-b">
                        <span class="text-gray-600">‡∏ó‡∏∏‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ (Margin):</span>
                        <span class="font-semibold text-blue-600">${margin.toFixed(2)} USDT</span>
                    </div>
                    <div class="flex justify-between items-center py-2 border-b">
                        <span class="text-gray-600">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏∞‡πÄ‡∏™‡∏µ‡∏¢‡∏´‡∏≤‡∏Å SL:</span>
                        <span class="font-semibold text-red-600">${riskAmount.toFixed(2)} USDT</span>
                    </div>
                </div>
                
                <div class="bg-green-50 p-4 rounded-lg mt-4">
                    <p class="text-sm text-green-700">üí° TP ‡∏ï‡∏≤‡∏°‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°‡∏Ñ‡∏ß‡∏£ 1:2 ‡∏Ç‡∏∂‡πâ‡∏ô‡πÑ‡∏õ ‡∏´‡∏≤‡∏Å‡∏°‡∏±‡πà‡∏ô‡πÉ‡∏à‡∏≠‡∏≤‡∏à‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô SL ‡∏°‡∏≤‡∏à‡∏∏‡∏î‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏î‡πâ</p>
                </div>
            `;

            if (riskPercent > 30) {
                resultHTML += `
                    <div class="bg-red-50 p-4 rounded-lg mt-4">
                        <p class="text-sm text-red-700 font-medium">‚ö†Ô∏è ‡πÅ‡∏û‡πâ‡πÅ‡∏•‡πâ‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏£‡πâ‡∏≠‡∏á‡∏ô‡∏∞‡∏™‡∏±‡∏™‡∏ñ‡πâ‡∏≤‡∏à‡∏∞‡πÄ‡∏¢‡∏≠‡∏∞‡∏Ç‡∏ô‡∏≤‡∏î‡∏ô‡∏µ‡πâ</p>
                    </div>
                `;
            }

            document.getElementById('resultContent').innerHTML = resultHTML;
            document.getElementById('results').classList.remove('hidden');
            document.getElementById('saveConfirmation').classList.remove('hidden');
        }

        // Save confirmation handlers
        document.getElementById('confirmSave').addEventListener('click', () => {
            if (currentCalculationData) {
                // Check checklist status
                let checklistStatus = null;
                let checklistProgress = null;
                
                if (activePresetId) {
                    const preset = checklistPresets.find(p => p.id === activePresetId);
                    if (preset) {
                        const currentState = checklistStates[activePresetId] || {};
                        const completed = Object.values(currentState).filter(Boolean).length;
                        const total = preset.items.length;
                        
                        checklistStatus = completed === total ? 'complete' : 'incomplete';
                        checklistProgress = `${completed}/${total}`;
                    }
                }
                
                const record = {
                    id: Date.now(),
                    date: new Date().toISOString(),
                    ...currentCalculationData,
                    orderType: null,
                    tp: null,
                    result: null,
                    profitAmount: null,
                    rr: null,
                    checklistStatus,
                    checklistProgress,
                    presetId: activePresetId
                };
                
                tradingRecords.push(record);
                localStorage.setItem('tradingRecords', JSON.stringify(tradingRecords));
                
                // Reset checklist after saving
                if (activePresetId) {
                    delete checklistStates[activePresetId];
                    localStorage.setItem('checklistStates', JSON.stringify(checklistStates));
                }
                
                // Reset form
                resetCalculatorForm();
                document.getElementById('saveConfirmation').classList.add('hidden');
                document.getElementById('results').classList.add('hidden');
                
                alert('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß! ‡πÄ‡∏ä‡πá‡∏Ñ‡∏•‡∏¥‡∏™‡∏ï‡πå‡∏ñ‡∏π‡∏Å‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡πÅ‡∏•‡πâ‡∏ß');
            }
        });

        document.getElementById('cancelSave').addEventListener('click', () => {
            document.getElementById('saveConfirmation').classList.add('hidden');
        });

        function resetCalculatorForm() {
            if (currentMode === 'forex') {
                document.getElementById('entryPrice').value = '';
                document.getElementById('stopLoss').value = '';
                document.getElementById('accountBalance').value = '';
                document.getElementById('riskPercent').value = '';
            } else {
                document.getElementById('cryptoEntryPrice').value = '';
                document.getElementById('cryptoStopLoss').value = '';
                document.getElementById('cryptoAccountBalance').value = '';
                document.getElementById('leverage').value = '';
                document.getElementById('cryptoRiskPercent').value = '';
            }
        }

        // Sort button handlers
        document.getElementById('sortNewest').addEventListener('click', () => {
            sortOrder = 'newest';
            updateSortButtons();
            loadRecords();
        });

        document.getElementById('sortOldest').addEventListener('click', () => {
            sortOrder = 'oldest';
            updateSortButtons();
            loadRecords();
        });

        function updateSortButtons() {
            document.querySelectorAll('.sort-btn').forEach(btn => {
                btn.className = 'sort-btn bg-gray-200 text-gray-700 px-3 py-1 rounded-lg text-sm font-medium transition-all';
            });
            
            if (sortOrder === 'newest') {
                document.getElementById('sortNewest').className = 'sort-btn bg-blue-500 text-white px-3 py-1 rounded-lg text-sm font-medium transition-all';
            } else {
                document.getElementById('sortOldest').className = 'sort-btn bg-blue-500 text-white px-3 py-1 rounded-lg text-sm font-medium transition-all';
            }
        }

        // Load records
        function loadRecords() {
            const recordsList = document.getElementById('recordsList');
            
            if (tradingRecords.length === 0) {
                recordsList.innerHTML = '<p class="text-gray-500 text-center py-8">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏ó‡∏£‡∏î</p>';
                return;
            }

            // Sort records based on current sort order
            const sortedRecords = [...tradingRecords].sort((a, b) => {
                if (sortOrder === 'newest') {
                    return new Date(b.date) - new Date(a.date); // Newest first
                } else {
                    return new Date(a.date) - new Date(b.date); // Oldest first
                }
            });

            const recordsHTML = sortedRecords.map(record => {
                const date = new Date(record.date).toLocaleDateString('th-TH');
                const time = new Date(record.date).toLocaleTimeString('th-TH', { hour: '2-digit', minute: '2-digit' });
                
                let statusBadge = '';
                if (record.result === 'Win') {
                    statusBadge = '<span class="bg-green-100 text-green-800 px-3 py-2 rounded-full text-lg font-bold">WIN</span>';
                } else if (record.result === 'Loss') {
                    statusBadge = '<span class="bg-red-100 text-red-800 px-3 py-2 rounded-full text-lg font-bold">LOSS</span>';
                } else {
                    statusBadge = '<span class="bg-gray-100 text-gray-800 px-2 py-1 rounded-full text-xs">‡∏£‡∏≠‡∏ú‡∏•</span>';
                }

                // Add checklist status badge
                let checklistBadge = '';
                if (record.checklistStatus === 'complete') {
                    checklistBadge = '<span class="bg-green-100 text-green-800 px-2 py-1 rounded-full text-xs">‚úÖ ‡πÄ‡∏ä‡πá‡∏Ñ‡∏•‡∏¥‡∏™‡∏Ñ‡∏£‡∏ö</span>';
                } else if (record.checklistStatus === 'incomplete') {
                    checklistBadge = '<span class="bg-red-100 text-red-800 px-2 py-1 rounded-full text-xs">‚ùå ‡πÄ‡∏ä‡πá‡∏Ñ‡∏•‡∏¥‡∏™‡πÑ‡∏°‡πà‡∏Ñ‡∏£‡∏ö</span>';
                } else {
                    checklistBadge = '<span class="bg-gray-100 text-gray-800 px-2 py-1 rounded-full text-xs">‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÄ‡∏ä‡πá‡∏Ñ‡∏•‡∏¥‡∏™</span>';
                }

                // Determine border color, background color, and profit display
                let borderClass = 'border-2 border-gray-200';
                let backgroundClass = 'bg-gray-50';
                let profitDisplay = '';
                
                // Check if record is complete (has result)
                const isComplete = record.result && record.orderType && record.tp;
                
                if (record.result === 'Win') {
                    borderClass = 'border-2 border-green-400';
                    backgroundClass = isComplete ? 'bg-green-50' : 'bg-gray-50';
                    profitDisplay = `<div class="mt-2 text-sm font-semibold text-green-600">üí∞ +${record.profitAmount ? record.profitAmount.toFixed(2) : '0.00'}</div>`;
                } else if (record.result === 'Loss') {
                    borderClass = 'border-2 border-red-400';
                    backgroundClass = isComplete ? 'bg-red-50' : 'bg-gray-50';
                    profitDisplay = `<div class="mt-2 text-sm font-semibold text-red-600">üí∏ -${record.riskAmount ? record.riskAmount.toFixed(2) : '0.00'}</div>`;
                } else {
                    borderClass = 'border-2 border-gray-400';
                    backgroundClass = 'bg-gray-50';
                }

                return `
                    <div class="${backgroundClass} rounded-lg ${borderClass} overflow-hidden">
                        <!-- Header - Always visible -->
                        <div class="p-4 cursor-pointer hover:bg-gray-100 transition-colors" onclick="toggleRecord(${record.id})">
                            <div class="flex justify-between items-center">
                                <div class="flex items-center gap-3">
                                    <div>
                                        <h4 class="font-medium text-gray-800">${record.type === 'forex' ? record.currencyPair : record.cryptoCoin}</h4>
                                        <p class="text-sm text-gray-600">${date} ${time}</p>
                                    </div>
                                    ${statusBadge}
                                </div>
                                <div class="flex items-center gap-2">
                                    ${profitDisplay ? profitDisplay.replace('<div class="mt-2 text-sm font-semibold', '<div class="text-sm font-semibold').replace('</div>', '').replace('üí∞ ', '').replace('üí∏ ', '') : '<span class="text-gray-500 text-sm">‡∏£‡∏≠‡∏ú‡∏•</span>'}
                                    <svg id="arrow-${record.id}" class="w-5 h-5 text-gray-400 transform transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                                    </svg>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Expandable Details -->
                        <div id="details-${record.id}" class="hidden border-t border-gray-200 bg-white">
                            <div class="p-4 space-y-3">
                                <div class="grid grid-cols-2 gap-4 text-sm">
                                    <div>
                                        <span class="text-gray-500">Entry:</span>
                                        <span class="font-medium">${record.entryPrice}</span>
                                    </div>
                                    <div>
                                        <span class="text-gray-500">SL:</span>
                                        <span class="font-medium">${record.stopLoss}</span>
                                    </div>
                                </div>
                                
                                ${record.tp ? `
                                    <div class="text-sm">
                                        <span class="text-gray-500">TP:</span>
                                        <span class="font-medium">${record.tp}</span>
                                        ${record.rr ? `<span class="ml-2 text-blue-600">R:R ${record.rr}</span>` : ''}
                                    </div>
                                ` : ''}
                                
                                ${record.result === 'Loss' && record.lossReason ? `
                                    <div class="text-sm bg-red-50 p-2 rounded border border-red-200">
                                        <span class="text-red-700 font-medium">‡∏™‡∏≤‡πÄ‡∏´‡∏ï‡∏∏‡∏Å‡∏≤‡∏£‡πÅ‡∏û‡πâ:</span>
                                        <span class="text-red-600">${record.lossReason}</span>
                                    </div>
                                ` : ''}
                                
                                <div class="flex gap-2">
                                    ${checklistBadge}
                                    ${record.checklistProgress ? `
                                        <span class="text-xs text-gray-600">${record.checklistProgress}</span>
                                    ` : ''}
                                </div>
                                
                                <div class="flex gap-2 pt-2 border-t border-gray-100">
                                    <button onclick="editRecord(${record.id}); event.stopPropagation();" class="flex-1 bg-blue-500 text-white py-2 px-3 rounded-lg text-sm font-medium hover:bg-blue-600 transition-colors">
                                        ‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
                                    </button>
                                    <button onclick="deleteRecordDirect(${record.id}); event.stopPropagation();" class="bg-red-500 text-white py-2 px-3 rounded-lg text-sm font-medium hover:bg-red-600 transition-colors">
                                        üóëÔ∏è
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');

            recordsList.innerHTML = recordsHTML;
        }

        // Toggle record details
        function toggleRecord(id) {
            const details = document.getElementById(`details-${id}`);
            const arrow = document.getElementById(`arrow-${id}`);
            
            if (details.classList.contains('hidden')) {
                details.classList.remove('hidden');
                arrow.style.transform = 'rotate(180deg)';
            } else {
                details.classList.add('hidden');
                arrow.style.transform = 'rotate(0deg)';
            }
        }

        // Delete record directly
        function deleteRecordDirect(id) {
            if (confirm('‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏µ‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')) {
                tradingRecords = tradingRecords.filter(r => r.id !== id);
                localStorage.setItem('tradingRecords', JSON.stringify(tradingRecords));
                loadRecords();
                alert('‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß!');
            }
        }

        // Edit record
        function editRecord(id) {
            const record = tradingRecords.find(r => r.id === id);
            if (!record) return;

            currentEditingId = id;
            
            // Populate edit form
            document.getElementById('editOrderType').value = record.orderType || '';
            document.getElementById('editTP').value = record.tp || '';
            document.getElementById('editResult').value = record.result || '';
            
            // Set initial field states
            const tpField = document.getElementById('editTP');
            const resultField = document.getElementById('editResult');
            
            if (!record.orderType) {
                tpField.disabled = true;
                tpField.classList.add('bg-gray-100', 'cursor-not-allowed');
                resultField.disabled = true;
                resultField.classList.add('bg-gray-100', 'cursor-not-allowed');
            } else {
                tpField.disabled = false;
                tpField.classList.remove('bg-gray-100', 'cursor-not-allowed');
                
                if (!record.tp) {
                    resultField.disabled = true;
                    resultField.classList.add('bg-gray-100', 'cursor-not-allowed');
                } else {
                    resultField.disabled = false;
                    resultField.classList.remove('bg-gray-100', 'cursor-not-allowed');
                }
            }
            
            if (record.result === 'Win') {
                document.getElementById('editProfitSection').classList.remove('hidden');
                document.getElementById('editLossSection').classList.add('hidden');
                document.getElementById('editProfitAmount').value = record.profitAmount || '';
            } else if (record.result === 'Loss') {
                document.getElementById('editProfitSection').classList.add('hidden');
                document.getElementById('editLossSection').classList.remove('hidden');
                document.getElementById('editLossAmount').value = record.riskAmount;
                
                // Load loss reason
                document.getElementById('editLossReason').value = record.lossReason || '';
                if (record.lossReason === '‡∏≠‡∏∑‡πà‡∏ô‡πÜ' && record.customLossReason) {
                    document.getElementById('customLossReasonSection').classList.remove('hidden');
                    document.getElementById('editCustomLossReason').value = record.customLossReason;
                } else {
                    document.getElementById('customLossReasonSection').classList.add('hidden');
                    document.getElementById('editCustomLossReason').value = '';
                }
            } else {
                document.getElementById('editProfitSection').classList.add('hidden');
                document.getElementById('editLossSection').classList.add('hidden');
            }

            if (record.rr) {
                document.getElementById('editRRSection').classList.remove('hidden');
                document.getElementById('editRR').value = record.rr;
            } else {
                document.getElementById('editRRSection').classList.add('hidden');
            }

            document.getElementById('editModal').classList.remove('hidden');
        }

        // Edit form handlers
        document.getElementById('editOrderType').addEventListener('change', handleOrderTypeChange);
        document.getElementById('editTP').addEventListener('input', calculateProfitFromTP);
        document.getElementById('editResult').addEventListener('change', handleResultChange);
        document.getElementById('editLossReason').addEventListener('change', handleLossReasonChange);

        function handleOrderTypeChange() {
            const orderType = document.getElementById('editOrderType').value;
            const tpField = document.getElementById('editTP');
            const resultField = document.getElementById('editResult');
            
            if (orderType) {
                tpField.disabled = false;
                tpField.classList.remove('bg-gray-100', 'cursor-not-allowed');
            } else {
                tpField.disabled = true;
                tpField.value = '';
                tpField.classList.add('bg-gray-100', 'cursor-not-allowed');
                
                // Also disable and reset result field
                resultField.disabled = true;
                resultField.value = '';
                resultField.classList.add('bg-gray-100', 'cursor-not-allowed');
                
                // Hide profit/loss sections
                document.getElementById('editProfitSection').classList.add('hidden');
                document.getElementById('editLossSection').classList.add('hidden');
                document.getElementById('editRRSection').classList.add('hidden');
            }
        }

        function calculateProfitFromTP() {
            const record = tradingRecords.find(r => r.id === currentEditingId);
            if (!record) return;

            const tp = parseFloat(document.getElementById('editTP').value);
            const orderType = document.getElementById('editOrderType').value;
            const resultField = document.getElementById('editResult');
            
            if (!tp || !orderType) {
                // Disable result field if TP is empty
                resultField.disabled = true;
                resultField.value = '';
                resultField.classList.add('bg-gray-100', 'cursor-not-allowed');
                
                // Hide profit/loss sections
                document.getElementById('editProfitSection').classList.add('hidden');
                document.getElementById('editLossSection').classList.add('hidden');
                document.getElementById('editRRSection').classList.add('hidden');
                return;
            }

            // Enable result field when TP is filled
            resultField.disabled = false;
            resultField.classList.remove('bg-gray-100', 'cursor-not-allowed');

            let profit = 0;
            
            if (record.type === 'crypto') {
                if (orderType === 'Buy') {
                    profit = (tp - record.entryPrice) * (record.margin * record.leverage) / record.entryPrice;
                } else if (orderType === 'Sell') {
                    profit = (record.entryPrice - tp) * (record.margin * record.leverage) / record.entryPrice;
                }
            } else if (record.type === 'forex') {
                const pipSetting = pipSettings[record.currencyPair];
                const pipDifference = Math.abs(tp - record.entryPrice) * pipSetting.multiplier;
                profit = pipDifference * pipSetting.pipValue * record.lotSize;
            }

            document.getElementById('editProfitAmount').value = profit.toFixed(2);
            
            // Calculate R:R
            if (profit > 0) {
                const rr = (profit / record.riskAmount).toFixed(2);
                document.getElementById('editRR').value = `1:${rr}`;
            }
        }

        function handleResultChange() {
            const result = document.getElementById('editResult').value;
            const record = tradingRecords.find(r => r.id === currentEditingId);
            
            if (result === 'Win') {
                document.getElementById('editProfitSection').classList.remove('hidden');
                document.getElementById('editLossSection').classList.add('hidden');
                document.getElementById('editRRSection').classList.remove('hidden');
                calculateProfitFromTP();
            } else if (result === 'Loss') {
                document.getElementById('editProfitSection').classList.add('hidden');
                document.getElementById('editLossSection').classList.remove('hidden');
                document.getElementById('editRRSection').classList.remove('hidden');
                document.getElementById('editLossAmount').value = record.riskAmount;
                document.getElementById('editRR').value = '1:0';
            } else {
                document.getElementById('editProfitSection').classList.add('hidden');
                document.getElementById('editLossSection').classList.add('hidden');
                document.getElementById('editRRSection').classList.add('hidden');
            }
        }

        function handleLossReasonChange() {
            const reason = document.getElementById('editLossReason').value;
            const customSection = document.getElementById('customLossReasonSection');
            
            if (reason === '‡∏≠‡∏∑‡πà‡∏ô‡πÜ') {
                customSection.classList.remove('hidden');
            } else {
                customSection.classList.add('hidden');
                document.getElementById('editCustomLossReason').value = '';
            }
        }

        // Save edit
        document.getElementById('saveEdit').addEventListener('click', () => {
            const orderType = document.getElementById('editOrderType').value;
            const tp = document.getElementById('editTP').value;
            const result = document.getElementById('editResult').value;

            // Validation
            let hasError = false;
            document.querySelectorAll('#editModal input, #editModal select').forEach(input => {
                input.classList.remove('border-red-500');
            });

            if (!orderType) {
                document.getElementById('editOrderType').classList.add('border-red-500');
                hasError = true;
            }
            if (!tp) {
                document.getElementById('editTP').classList.add('border-red-500');
                hasError = true;
            }
            if (!result) {
                document.getElementById('editResult').classList.add('border-red-500');
                hasError = true;
            }

            if (hasError) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô');
                return;
            }

            // Get loss reason data
            let lossReason = null;
            let customLossReason = null;
            
            if (result === 'Loss') {
                lossReason = document.getElementById('editLossReason').value;
                if (lossReason === '‡∏≠‡∏∑‡πà‡∏ô‡πÜ') {
                    customLossReason = document.getElementById('editCustomLossReason').value.trim();
                    if (!customLossReason) {
                        alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡∏™‡∏≤‡πÄ‡∏´‡∏ï‡∏∏‡∏Å‡∏≤‡∏£‡πÅ‡∏û‡πâ');
                        return;
                    }
                    lossReason = customLossReason;
                }
                
                if (!lossReason) {
                    document.getElementById('editLossReason').classList.add('border-red-500');
                    alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏≤‡πÄ‡∏´‡∏ï‡∏∏‡∏Å‡∏≤‡∏£‡πÅ‡∏û‡πâ');
                    return;
                }
            }

            // Update record
            const recordIndex = tradingRecords.findIndex(r => r.id === currentEditingId);
            if (recordIndex !== -1) {
                tradingRecords[recordIndex] = {
                    ...tradingRecords[recordIndex],
                    orderType,
                    tp: parseFloat(tp),
                    result,
                    profitAmount: result === 'Win' ? parseFloat(document.getElementById('editProfitAmount').value) : null,
                    rr: document.getElementById('editRR').value,
                    lossReason: result === 'Loss' ? lossReason : null,
                    customLossReason: result === 'Loss' && document.getElementById('editLossReason').value === '‡∏≠‡∏∑‡πà‡∏ô‡πÜ' ? customLossReason : null
                };

                localStorage.setItem('tradingRecords', JSON.stringify(tradingRecords));
                document.getElementById('editModal').classList.add('hidden');
                loadRecords();
                alert('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß!');
            }
        });

        // Cancel edit
        document.getElementById('cancelEdit').addEventListener('click', () => {
            document.getElementById('editModal').classList.add('hidden');
        });

        // Delete record
        document.getElementById('deleteRecord').addEventListener('click', () => {
            if (confirm('‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏µ‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')) {
                tradingRecords = tradingRecords.filter(r => r.id !== currentEditingId);
                localStorage.setItem('tradingRecords', JSON.stringify(tradingRecords));
                document.getElementById('editModal').classList.add('hidden');
                loadRecords();
                alert('‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß!');
            }
        });

        // Load statistics
        function loadStats() {
            const totalTrades = tradingRecords.filter(r => r.result).length;
            const wins = tradingRecords.filter(r => r.result === 'Win').length;
            const losses = tradingRecords.filter(r => r.result === 'Loss').length;
            const winRate = totalTrades > 0 ? ((wins / totalTrades) * 100).toFixed(1) : 0;
            
            const totalProfit = tradingRecords
                .filter(r => r.result === 'Win')
                .reduce((sum, r) => sum + (r.profitAmount || 0), 0);
            
            const totalLoss = tradingRecords
                .filter(r => r.result === 'Loss')
                .reduce((sum, r) => sum + (r.riskAmount || 0), 0);

            // Calculate average R:R
            const rrValues = tradingRecords
                .filter(r => r.rr && r.rr !== '1:0')
                .map(r => parseFloat(r.rr.split(':')[1]));
            
            const avgRR = rrValues.length > 0 ? 
                `1:${(rrValues.reduce((sum, val) => sum + val, 0) / rrValues.length).toFixed(2)}` : 
                '0:0';

            document.getElementById('totalTrades').textContent = totalTrades;
            document.getElementById('winRate').textContent = `${winRate}%`;
            document.getElementById('totalProfit').textContent = `+${totalProfit.toFixed(2)}`;
            document.getElementById('totalLoss').textContent = `-${totalLoss.toFixed(2)}`;
            document.getElementById('avgRR').textContent = avgRR;

            // Simple chart
            if (totalTrades > 0) {
                const chartHTML = `
                    <div class="flex items-end justify-center space-x-4 h-24">
                        <div class="flex flex-col items-center">
                            <div class="bg-green-500 rounded-t" style="height: ${(wins/totalTrades)*80}px; width: 40px;"></div>
                            <span class="text-xs mt-1">Win (${wins})</span>
                        </div>
                        <div class="flex flex-col items-center">
                            <div class="bg-red-500 rounded-t" style="height: ${(losses/totalTrades)*80}px; width: 40px;"></div>
                            <span class="text-xs mt-1">Loss (${losses})</span>
                        </div>
                    </div>
                `;
                document.getElementById('chartContainer').innerHTML = chartHTML;
            }

            // Load preset statistics
            loadPresetStats();
        }

        // Load preset statistics
        function loadPresetStats() {
            const presetStatsContainer = document.getElementById('presetStats');
            
            // Get records with preset data and results
            const recordsWithPresets = tradingRecords.filter(r => 
                r.presetId && r.result
            );
            
            if (recordsWithPresets.length === 0) {
                presetStatsContainer.innerHTML = '<p class="text-gray-500 text-center py-4">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏ó‡∏£‡∏î‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏û‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï</p>';
                return;
            }

            // Group by preset ID
            const presetGroups = {};
            recordsWithPresets.forEach(record => {
                if (!presetGroups[record.presetId]) {
                    presetGroups[record.presetId] = [];
                }
                presetGroups[record.presetId].push(record);
            });

            let statsHTML = '';
            const presetStats = [];

            // Calculate stats for each preset
            Object.keys(presetGroups).forEach(presetId => {
                const preset = checklistPresets.find(p => p.id == presetId);
                if (!preset) return;

                const records = presetGroups[presetId];
                const wins = records.filter(r => r.result === 'Win').length;
                const losses = records.filter(r => r.result === 'Loss').length;
                const total = records.length;
                const winRate = total > 0 ? ((wins / total) * 100).toFixed(1) : 0;

                presetStats.push({
                    preset,
                    wins,
                    losses,
                    total,
                    winRate: parseFloat(winRate)
                });

                // Color scheme based on win rate
                let bgColor = 'bg-gray-50 border-gray-200';
                let textColor = 'text-gray-800';
                let winRateColor = 'text-gray-700';
                
                if (winRate >= 70) {
                    bgColor = 'bg-green-50 border-green-200';
                    textColor = 'text-green-800';
                    winRateColor = 'text-green-700';
                } else if (winRate >= 50) {
                    bgColor = 'bg-blue-50 border-blue-200';
                    textColor = 'text-blue-800';
                    winRateColor = 'text-blue-700';
                } else {
                    bgColor = 'bg-red-50 border-red-200';
                    textColor = 'text-red-800';
                    winRateColor = 'text-red-700';
                }

                statsHTML += `
                    <div class="${bgColor} border rounded-lg p-4 mb-4">
                        <div class="flex items-center gap-2 mb-3">
                            <span class="text-lg">üìã</span>
                            <h4 class="font-semibold ${textColor}">${preset.name}</h4>
                        </div>
                        
                        <div class="grid grid-cols-3 gap-4 mb-3">
                            <div class="text-center">
                                <div class="text-xl font-bold text-blue-600">${total}</div>
                                <div class="text-xs text-gray-600">‡πÄ‡∏ó‡∏£‡∏î‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</div>
                            </div>
                            <div class="text-center">
                                <div class="text-xl font-bold text-emerald-600">${wins}</div>
                                <div class="text-xs text-gray-600">‡∏ä‡∏ô‡∏∞</div>
                            </div>
                            <div class="text-center">
                                <div class="text-xl font-bold text-red-600">${losses}</div>
                                <div class="text-xs text-gray-600">‡πÅ‡∏û‡πâ</div>
                            </div>
                        </div>
                        
                        <div class="bg-white rounded-lg p-3 text-center">
                            <div class="text-lg font-bold ${winRateColor}">${winRate}%</div>
                            <div class="text-sm text-gray-600">‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏ä‡∏ô‡∏∞</div>
                        </div>
                    </div>
                `;
            });

            // Add comparison if multiple presets exist
            if (presetStats.length > 1) {
                // Sort by win rate
                presetStats.sort((a, b) => b.winRate - a.winRate);
                const best = presetStats[0];
                const worst = presetStats[presetStats.length - 1];
                
                if (best.winRate !== worst.winRate) {
                    const difference = (best.winRate - worst.winRate).toFixed(1);
                    
                    statsHTML += `
                        <div class="bg-purple-50 border border-purple-200 rounded-lg p-4">
                            <div class="text-center">
                                <h4 class="font-semibold text-purple-800 mb-2">üèÜ ‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏û‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï</h4>
                                <p class="text-sm text-gray-700 mb-2">
                                    <span class="font-bold text-green-600">${best.preset.name}</span>
                                    ‡∏°‡∏µ‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏ä‡∏ô‡∏∞‡∏™‡∏π‡∏á‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î
                                    <span class="font-bold text-green-600">${best.winRate}%</span>
                                </p>
                                <p class="text-sm text-gray-700">
                                    ‡∏™‡∏π‡∏á‡∏Å‡∏ß‡πà‡∏≤
                                    <span class="font-bold text-red-600">${worst.preset.name}</span>
                                    ‡∏ñ‡∏∂‡∏á <span class="font-bold text-purple-600">${difference}%</span>
                                </p>
                                <p class="text-xs text-gray-600 mt-2">
                                    üí° ‡∏Ñ‡∏ß‡∏£‡πÉ‡∏ä‡πâ‡∏û‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï "${best.preset.name}" ‡∏ö‡πà‡∏≠‡∏¢‡∏Ç‡∏∂‡πâ‡∏ô
                                </p>
                            </div>
                        </div>
                    `;
                }
            }

            presetStatsContainer.innerHTML = statsHTML;
        }

        // Initialize
        checkDailyLimit();
        
        // Load saved active preset
        const savedActivePresetId = localStorage.getItem('activePresetId');
        if (savedActivePresetId) {
            activePresetId = parseInt(savedActivePresetId);
        }
        
        // Start with checklist page
        switchPage('checklist');
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9610c8eda2ef45c5',t:'MTc1MjgyOTE4Ni4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
